<!DOCTYPE html>   ï¼œ!DOCTYPE html >   ï¼œ!DOCTYPE html >
<html   è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€    < html   è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ lang   æœ— = "åº”ç”¨" >lang="zh-CN">
<head   å¤´>
    <link   é“¾æ¥ rel="icon"   â€œå›¾æ ‡â€ type   ç±»å‹="image/png"   â€œå›¾åƒ/ pngâ€ href="../src/icon.svg">
    <meta   å…ƒ charset   å­—ç¬¦é›†="UTF-8"   â€œutf - 8â€>
    <meta   å…ƒ name   åå­—="viewport"   â€œè§†å£â€ content   å†…å®¹="width=device-width, initial-scale=1.0, user-scalable=no"â€œwidth   â€œå®½=device-width,   è®¾å¤‡å®½åº¦, initial-scale   åˆå§‹=1.0, user-scalable=noâ€   ä¸â€>
    <æ ‡é¢˜> < /æ ‡é¢˜>ç”Ÿæ—¥å¿«ä¹<title   æ ‡é¢˜>Happy Birthday</title   æ ‡é¢˜>
       ï¼œ!â€”â€”é¡ºé£CSSâ€”â€”><!-- Tailwind CSS -->   ï¼œ!â€”â€”é¡ºé£CSSâ€”â€”>
    < script   è„šæœ¬ src = " https://cdn.tailwindcss.com " > < /è„šæœ¬><script src="https://cdn.tailwindcss.com   å’Œ"></script   è„šæœ¬>
    <!-- Three.js -->
    < script    è„šæœ¬src = " https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js " > < /è„šæœ¬><script src="https://cdnjs.cloudflare.com   å’Œ/ajax/libs   å¡«è¯/three   ä¸‰ä¸ª.js/r128/three   ä¸‰ä¸ª.min   æœ€å°å€¼.js"></script   è„šæœ¬>
       ï¼œ   ï¼œ!å­—ä½“â€”â€”>!å­—ä½“â€”â€”><!-- Google    è°·æ­ŒFonts   å­—ä½“ -->
    <link    é“¾æ¥href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Noto+Serif+SC:wght@500;700&display=swap""https://fonts.googleapis.com/css2?family=Dancing Script:wght@700&family= no - Serif SC:wght@500ï¼›700 rel="   â€œæ ·å¼è¡¨â€stylesheet   æ ·å¼è¡¨">
    
       ï¼œ   ï¼œ!â€”â€”mediappe Handsâ€”â€”   æ‰‹â€”â€”>!â€”â€”mediappe Handsâ€”â€”   æ‰‹â€”â€”><!-- MediaPipe Hands   æ‰‹ -->
    <script    è„šæœ¬src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js""https://cdn.jsdelivr.net
pm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js" crossorigin="   â€œåŒ¿åâ€anonymous"></script   è„šæœ¬>
    <script    è„šæœ¬src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.6.1629159505/control_utils.js""https://cdn.jsdelivr.net
pm/@mediapipe/control_utils@0.6.1629159505/control_utils.js" crossorigin="   â€œåŒ¿åâ€anonymous"></script   è„šæœ¬>
    <script    è„šæœ¬src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1620248257/drawing_utils.js""https://cdn.jsdelivr.net
pm/@mediapipe/drawing_utils@0.3.1620248257/drawing_utils.js" crossorigin="   â€œåŒ¿åâ€anonymous"></script   è„šæœ¬>
    <script    è„šæœ¬src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js""https://cdn.jsdelivr.net
pm/@mediapipe/hands@0.4.1646424915/hands.js" crossorigin="   â€œåŒ¿åâ€anonymous"></script   è„šæœ¬>

       < >é£æ ¼<style   é£æ ¼>
        :ï¼šroot   :æ ¹{â€”â€”bg-gradientï¼šå¾„å‘æ¢¯åº¦ï¼ˆåœ†å¿ƒï¼Œ#1a0b1a 0%, #000000 100%ï¼‰ï¼›}root    æ ¹{ --bg   â€”â€”bg-gradient   æ¢¯åº¦-gradient   æ¢¯åº¦: radial   å¾„å‘æ¸å˜-gradient   æ¢¯åº¦(circle    åœ†at    åœ¨center, #1a0b1a 0%, #000000 100%); }
           èº«ä½“{body    èº«ä½“{ 
            ä¿è¯é‡‘:0;æº¢å‡º:éšè—;margin   ä¿è¯é‡‘: 0; overflow   æº¢å‡º: hidden   éšè—çš„; 
            background   èƒŒæ™¯ - color   é¢œè‰²: # 000000;èƒŒæ™¯å›¾ç‰‡:var(â€”â€”bg-gradient   æ¢¯åº¦);background   èƒŒæ™¯é¢œè‰²-color   é¢œè‰²: #000000   èƒŒæ™¯å›¾åƒ; background   èƒŒæ™¯-image   å›¾åƒ: var(--bg   â€”â€”bg-gradient   æ¢¯åº¦-gradient   æ¢¯åº¦); 
            font   å­—ä½“ç±»å‹-family   å®¶åº­: â€˜æ— è¡¬çº¿â€™ï¼ŒSerifï¼›é¢œè‰²:ç™½è‰²;font   å­—ä½“ç±»å‹-family   å®¶åº­: 'Noto Serif SC'   â€œæ— è¡¬çº¿SCâ€, serif   è¡¬çº¿; color   é¢œè‰²: white   ç™½è‰²; 
            ç”¨æˆ·é€‰æ‹©:æ²¡æœ‰;-webkit-tap   åˆ©ç”¨-highlight   çªå‡º-color   é¢œè‰²:é€æ˜;user   ç”¨æˆ·é€‰æ‹©-select   é€‰æ‹©: none   æ²¡æœ‰ä¸€ä¸ª; -webkit-tap   åˆ©ç”¨-highlight   çªå‡º-color   é¢œè‰²: transparent   é€æ˜çš„;
               touch-action   è¡ŒåŠ¨:æ²¡æœ‰;touch-action   è¡ŒåŠ¨: none   æ²¡æœ‰ä¸€ä¸ª;
        }
        ##canvas   #å¸†å¸ƒ-container   ç”»å¸ƒå®¹å™¨ {position   ä½ç½®: absoluteï¼›ä¸Šå›¾:0;å·¦:0;å®½åº¦:100å¤§ä¼—;èº«é«˜:100 vh;z - index   æŒ‡æ•°: 1;å…‰æ ‡:æŠ“ä½;}canvas   ç”»å¸ƒå®¹å™¨-container   å®¹å™¨ { position   ä½ç½®: absolute   ç»å¯¹; top   å‰: 0; left   å·¦: 0; width   å®½åº¦: 100vw   å°é•‡; height   é«˜åº¦: 100vh; z-index   æŒ‡æ•°: 1; cursor   å…‰æ ‡: grab   æŠ“ä½; }
        ##canvas   #å¸†å¸ƒ-container   ç”»å¸ƒå®¹å™¨:active   æ´»è·ƒçš„{æ¸¸æ ‡ï¼šæŠ“å–ï¼›}canvas   ç”»å¸ƒå®¹å™¨-container   å®¹å™¨:active    æ´»è·ƒçš„{ cursor   å…‰æ ‡: grabbing   æŠ“ä½; }
        
        /* ç¿»è½¬å¡ç‰‡ */
        .ï¼Flip   ï¼æ´»é¡µç‰‡-card   å¡{èƒŒæ™¯é¢œè‰²ï¼šé€æ˜ï¼›è§’åº¦:1000 px;}flip   æ´»é¡µç‰‡-card   å¡ { background   èƒŒæ™¯é¢œè‰²-color   é¢œè‰²: transparent   é€æ˜çš„; perspective   è§’åº¦æ¥çœ‹: 1000px; }
        .   ï¼flip   .flip   ç¿»è½¬-card   å¡-inner   å†…å¿ƒçš„-card   å¡-inner   å†…å¿ƒçš„ {flip-card   å¡-inner   å†…å¿ƒçš„ {
            ä½ç½®:ç›¸å¯¹;å®½åº¦:100%;é«˜åº¦:100%;text-align   å¯¹é½:ä¸­å¿ƒ;position   ä½ç½®: relative   ç›¸å¯¹; width   å®½åº¦: 100%; height   é«˜åº¦: 100%; text-align   å¯¹é½: center   ä¸­å¿ƒ;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);è¿‡æ¸¡ï¼šå˜æ¢0.8sç«‹æ–¹bezier(0.175, 0.885, 0.32, 1.275)ï¼›
            transform-style: preserve-3d;ä¼ è¾“æ ¼å¼:preserve   ä¿å­˜-3d;
        }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }.flip   ç¿»è½¬-cardã€‚ç¿»è½¬ã€‚{å˜æ¢ï¼šæ—‹è½¬ï¼ˆ180åº¦ï¼‰ï¼›}
        .flip-card-front, .flip-card-back {ï¼flip   .flip   ç¿»è½¬-card   å¡-frontã€‚flip   å‰é¢ã€‚ç¿»è½¬-card   å¡-back   å›æ¥ {
            position: absolute; width: 100%; height: 100%;ä½ç½®:ç»å¯¹çš„;å®½åº¦:100%;é«˜åº¦:100%;
            -webkit-backface-visibility: hidden; backface-visibility: hidden;-webkit-backface   æ²¿å¢™-visibility   å¯è§æ€§:éšè—;backface   æ²¿å¢™-visibility   å¯è§æ€§:éšè—;
            border-radius: 1.2rem; overflow: hidden;border   è¾¹å¢ƒ - radius   åŠå¾„: 1.2å¿«é€Ÿçœ¼åŠ¨;æº¢å‡º:éšè—;
        }
        .flip-card-back { transform: rotateY(180deg); }ï¼{transform   å˜æ¢: rotateYï¼ˆ180åº¦ï¼‰ï¼›}

        /* UI å±‚ */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; padding: 1.5rem; box-sizing: border-box; transition: opacity 0.5s; }#ui   # iu-layer   å±‚ {positionï¼šç»å¯¹ï¼›ä¸Šè¡£:0;æœ¬è½®0;width   å®½åº¦: 100%;height   é«˜åº¦: 100%;z-index   æŒ‡æ•°: 10;pointer   æŒ‡é’ˆ-events   äº‹ä»¶:å‡è®¾çš„;å±å¹•:æ‰©å¼€;flex-direction   æ–¹å‘: column   åˆ—;justify   è¯æ˜-content   å†…å®¹: space-between;padding   å¡«å……: 1.5rem   å¿«é€Ÿçœ¼åŠ¨;box-sizing: border   è¾¹å¢ƒ-box;è¿‡æ¸¡ï¼šä¸é€æ˜åº¦0.5sï¼›â€¦â€¦
        .interactive-element { pointer-events: auto; cursor: pointer; }.interactive   äº’åŠ¨-element   å…ƒç´  {pointer   æŒ‡é’ˆ-events   äº‹ä»¶: autoï¼›å…‰æ ‡:æŒ‡é’ˆ;}
        .input_video { display: none; }ï¼Input_video{æ˜¾ç¤ºï¼šæ— ï¼›}
        .glass-panel { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1.5rem; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); }ï¼Glass   ï¼ç»ç’ƒ-panel   é¢æ¿ {background   èƒŒæ™¯: rgba(255,255,255,0.05)ï¼›backdrop   ,èƒŒæ™¯-filter   è¿‡æ»¤å™¨:æ¨¡ç³Š(12 px);è¾¹æ¡†ï¼š1pxå®å¿ƒrgba(255,255,255,0.1)ï¼›border   è¾¹ç•Œ; - radius   åŠå¾„: 1.5å¿«é€Ÿçœ¼åŠ¨;Box   ç›’å­-shadow   å½±å­: 0 8px 32px 0 rgba(0,0,0,0.5)ï¼›}
        
        /* å¯åŠ¨é¡µæ ·å¼ */
        #start-overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; ä½ç½®:ç»å¯¹çš„;ä¸Šå›¾:0;å·¦:0;å®½åº¦:100%;é«˜åº¦:100%;
            background: rgba(0,0,0,0.6); èƒŒæ™¯:rgba (0, 0, 0, 0.6);
            z-index: 9999; 
            display: flex; justify-content: center; align-items: center; æ˜¾ç¤º:flex;justify   è¯æ˜-content   å†…å®¹:ä¸­å¿ƒ;å¯¹é½é¡¹ç›®:ä¸­å¿ƒ;
            pointer-events: auto;   pointer   æŒ‡é’ˆ-events   äº‹ä»¶:æ±½è½¦;
            transition: opacity 0.8s ease, visibility 0.8s;è¿‡æ¸¡ï¼šä¸é€æ˜åº¦0.8sï¼Œå¯è§åº¦0.8sï¼›   å¹´ä»£;
        }
        #start-overlay.hidden { opacity: 0; visibility: hidden; pointer-events: none; }# start   å¼€å§‹-overlayã€‚éšè—{é€æ˜åº¦ï¼š0ï¼›å¯è§æ€§:éšè—;pointer   æŒ‡é’ˆ-events   äº‹ä»¶:æ²¡æœ‰;}
        
        .start-card {   ï¼start   .start-card   å¡ {
            background: rgba(20, 10, 20, 0.75);èƒŒæ™¯ï¼šrgba(20,10,20,0.75)ï¼›
            backdrop-filter: blur(16px);backdrop   èƒŒæ™¯-filter   è¿‡æ»¤å™¨:æ¨¡ç³Š(16 px);
            border: 1px solid rgba(255, 105, 180, 0.3);è¾¹æ¡†ï¼š1pxå®å¿ƒrgba(255, 105, 180, 0.3)ï¼›
            box-shadow: 0 0 50px rgba(255, 105, 180, 0.2);Box   ç›’å­-shadow   å½±å­: 0 0 50px rgba(255, 105, 180, 0.2)ï¼›
        }

        #blow-meter-container { position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%); width: 280px; height: 12px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; opacity: 0; transition: opacity 0.5s; }#blow   #å¹-meter   è®¡-container   å®¹å™¨{ä½ç½®ï¼šç»å¯¹ï¼›åº•:15%;å·¦:50%;transform   å˜æ¢: translateX (-50%);width   å®½åº¦: 280px;height   é«˜åº¦: 12px;èƒŒæ™¯:rgba (255,255,255,0.1);border   è¾¹å¢ƒ-radius   åŠå¾„: 10px;overflow   æº¢å‡º:éšè—çš„;opacity   ä¸é€æ˜åº¦: 0;è¿‡æ¸¡ï¼šä¸é€æ˜åº¦0.5sï¼›â€¦â€¦
        #blow-meter-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #ff9a9e 0%, #ff69b4 100%); border-radius: 10px; transition: width 0.1s linear; box-shadow: 0 0 15px #ff69b4; }#å¹ç±³æ†{é«˜åº¦ï¼š100%ï¼›width   å®½åº¦;:ä¹Ÿ;èƒŒæ™¯ï¼šçº¿æ€§æ¢¯åº¦ï¼ˆ90deg, #ff9a9e 0%, #ff69b4 100%ï¼‰ï¼›border-radius   åŠå¾„: 10px;è¿‡æ¸¡ï¼šå®½åº¦0.1sçº¿æ€§ï¼›Box -shadow   å½±å­: 0 0 15px #ff69b4ï¼›â€¦â€¦
        #blow-hint { position: absolute; bottom: 18%; width: 100%; text-align: center; font-size: 14px; color: rgba(255,255,255,0.8); text-shadow: 0 2px 4px rgba(0,0,0,0.8); opacity: 0; transition: opacity 0.5s; }#blow   #å¹-hint{ä½ç½®ï¼šç»å¯¹ï¼›åº•:18%;width   å®½åº¦: 100%;text   æ–‡æœ¬-align   å¯¹é½:ä¸­å¿ƒ;font   å­—ä½“-size   å¤§å°: 14px;æ´»åŠ¨ä¸­ä¸€:rgba (255,255,255,0.8);æ–‡æœ¬é˜´å½±ï¼š0 2px 4px rgba(0,0,0,0.8)ï¼›opacity: 0;è¿‡æ¸¡ï¼šä¸é€æ˜åº¦0.5sï¼›â€¦â€¦

        #surprise-layer { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 80; pointer-events: none; transition: background 0.5s ease; }#surprise   #æƒŠå–œ-layer   å±‚ {position   ä½ç½®: absoluteï¼›æ’å›¾:0;æ˜¾ç¤º:flex;flex-direction   æ–¹å‘:åˆ—;justify   è¯æ˜-content   å†…å®¹:ä¸­å¿ƒ;å¯¹é½é¡¹ç›®:ä¸­å¿ƒ;z - index   æŒ‡æ•°: 80;pointer   æŒ‡é’ˆ-events   äº‹ä»¶:æ²¡æœ‰;è¿‡æ¸¡ï¼šèƒŒæ™¯èˆ’ç¼“0.5sï¼›   å¹´ä»£;}
        #surprise-layer.hidden { display: none !important; }# surprise   æƒŠå–œ-layerã€‚éšè—{æ˜¾ç¤ºï¼šnone !importantï¼›   é‡è¦;}
        #surprise-layer.active { pointer-events: auto; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); }# surprise   æƒŠå–œ-layerã€‚æ´»åŠ¨{æŒ‡é’ˆäº‹ä»¶ï¼šè‡ªåŠ¨ï¼›èƒŒæ™¯:rgba (0, 0, 0, 0.4);backdrop   èƒŒæ™¯-filter   è¿‡æ»¤å™¨:æ¨¡ç³Š(4 px);}

        .font-handwriting { font-family: 'Dancing Script', cursive; }ï¼font   font-handwriting   ç¬”è¿¹ {font   å­—ä½“-family   å®¶åº­: " Dancing Script "   â€œèˆè¹ˆå‰§æœ¬â€ï¼Œè‰ä½“ï¼›}
        .pop-in { animation: popIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }ï¼popIn {animation   åŠ¨ç”»: popIn 0.6s    å¹´ä»£cubic   ç«‹æ–¹-bezier   è´å¡å°”æ›²çº¿(0.34, 1.56, 0.64, 1) forwardï¼›   å‘å‰;}
        .animate-float { animation: float 3s ease-in-out infinite; }ï¼animation   .animation -float   æµ®åŠ¨{åŠ¨ç”»ï¼šæµ®åŠ¨3s ease   ç¼“è§£-in   åœ¨-outæ— é™ï¼›}
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }@keyframes   å…³é”®å¸§ float    æµ®åŠ¨{0%, 100% {transform: translateY(0)ï¼›} 50% {transform: translateY(-10px)ï¼›}}
        .safe-click-area { z-index: 90; position: relative; touch-action: manipulation; }ï¼å®‰å…¨ç‚¹å‡»åŒºåŸŸ{z-index: 90ï¼›ä½ç½®:ç›¸å¯¹;touch-action:æ“çºµ;}
        .neon-text { text-shadow: 0 0 10px rgba(255,105,180,0.7), 0 0 20px rgba(255,105,180,0.5); }ï¼Neon-text {text-shadow: 0 0 10px rgba(255,105,180,0.7), 0 0 20px rgba(255,105,180,0.5)ï¼›}

        #floating-gift-btn {
            position: absolute; bottom: 30px; right: 30px; z-index: 200; width: 60px; height: 60px; border-radius: 50%;ä½ç½®:ç»å¯¹çš„;åº•éƒ¨:30 px;å³:30 px;z - index: 200;å®½åº¦:60 px;é«˜åº¦:60 px;è¿™ä¸ªç‰¹æ€§:50%;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 105, 180, 0.5);èƒŒæ™¯ï¼šrgba(255, 255, 255, 0.1)ï¼›backdrop-filter:æ¨¡ç³Š(10 px);è¾¹æ¡†ï¼š1pxå®å¿ƒrgba(255, 105, 180, 0.5)ï¼›
            display: flex; justify-content: center; align-items: center; font-size: 30px; cursor: pointer;æ˜¾ç¤º:flex;justify-content:ä¸­å¿ƒ;å¯¹é½é¡¹ç›®:ä¸­å¿ƒ;å­—ä½“å¤§å°:30 px;å…‰æ ‡:æŒ‡é’ˆ;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.4); animation: float-btn 3s ease-in-out infinite;Box-shadow: 0 0 20px rgba(255, 105, 180, 0.4)ï¼›åŠ¨ç”»ï¼šfloat-btn 3s ease-in-out infiniteï¼›
            transition: transform 0.3s, background 0.3s; pointer-events: auto;è¿‡æ¸¡ï¼šå˜æ¢0.3sï¼ŒèƒŒæ™¯0.3sï¼›pointer-events:æ±½è½¦;
        }
        #floating-gift-btn:hover { transform: scale(1.1) rotate(10deg); background: rgba(255, 105, 180, 0.3); }#float -gift-btn:hover {transform: scale(1.1) rotateï¼ˆ10åº¦ï¼‰ï¼›èƒŒæ™¯ï¼šrgba(255, 105, 180, 0.3)ï¼›}
        #floating-gift-btn.hidden { display: none !important; }# floating-gift-btnã€‚éšè—{æ˜¾ç¤ºï¼šnone !importantï¼›}
        @keyframes float-btn { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }@keyframes   å…³é”®å¸§ float   æµ®åŠ¨-btn {0%, 100% {transform   å˜æ¢: translateY(0)ï¼›} 50% {transform   å˜æ¢: translateY(-10px)ï¼›}}

        #settings-panel {   #è®¾ç½®é¢æ¿{
            position: absolute; top: 80px; right: 20px; width: 140px;ä½ç½®:ç»å¯¹çš„;å‰:80åƒç´ ;å³:20 px;å®½åº¦:140 px;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px);èƒŒæ™¯ï¼šrgba(0,0,0,0.6)ï¼›backdrop   ,èƒŒæ™¯-filter   è¿‡æ»¤å™¨:æ¨¡ç³Š(8 px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px;Border   è¾¹å¢ƒ: 1px solid    å›ºä½“rgba(255,255,255,0.2)ï¼›border   è¾¹ç•Œ; - radius   åŠå¾„: 12 px;
            padding: 15px; z-index: 50; display: none; å¡«å……:15 px;z - index   æŒ‡æ•°: 50;æ˜¾ç¤º:æ²¡æœ‰;
            flex-direction: column; gap: 10px; pointer-events: auto;flex-direction   æ–¹å‘:åˆ—;å·®è·:10 px;pointer   æŒ‡é’ˆ-events   äº‹ä»¶:æ±½è½¦;
        }
        .color-control { display: flex; align-items: center; justify-content: space-between; font-size: 12px; color: #ddd; }ï¼é¢œè‰²æ§åˆ¶{æ˜¾ç¤ºï¼šflexï¼›å¯¹é½é¡¹ç›®:ä¸­å¿ƒ;justify   è¯æ˜-content:ä¹‹é—´çš„ç©ºé—´;å­—ä½“å¤§å°:12 px;é¢œè‰²:# ddd;}
        .color-control input { width: 30px; height: 20px; border: none; border-radius: 4px; cursor: pointer; background: transparent; }ï¼é¢œè‰²æ§åˆ¶è¾“å…¥{å®½åº¦ï¼š30pxï¼›é«˜åº¦:20 px;è¾¹ç•Œ:æ²¡æœ‰;border - radius: 4 px;å…‰æ ‡:æŒ‡é’ˆ;èƒŒæ™¯:é€æ˜;}

        #top-banner {   #é¡¶éƒ¨æ¨ªå¹…{
            position: absolute; top: 15%; left: 0; width: 100%;ä½ç½®:ç»å¯¹çš„;ä¸Šå›¾:15%;å·¦:0;å®½åº¦:100%;
            text-align: center; pointer-events: none; z-index: 5;text-align:ä¸­å¿ƒ;pointer-events:æ²¡æœ‰;z - index: 5;
            animation: float-banner 4s ease-in-out infinite;åŠ¨ç”»ï¼šfloat-banner 4s ease-in-out infiniteï¼›
        }
        #top-banner.hidden { display: none !important; }#é¡¶éƒ¨çš„æ¨ªå¹…ã€‚éšè—{æ˜¾ç¤ºï¼šnone !importantï¼›}
        .banner-text {   ï¼banner-text {
            font-family: 'Dancing Script', cursive;font-family: 'Dancing Script'ï¼Œè‰ä½“ï¼›
            background: linear-gradient(to right, #ff9a9e, #fad0c4, #fad0c4, #a18cd1, #fbc2eb);èƒŒæ™¯ï¼šçº¿æ€§æ¸å˜ï¼ˆå‘å³ï¼Œ#ff9a9e, #fad0c4, #fad0c4, #a18cd1, #fbc2ebï¼‰ï¼›
            -webkit-background-clip: text; background-clip: text; color: transparent;-webkit-background-clip:æ–‡æœ¬;background-clip:æ–‡æœ¬;é¢œè‰²:é€æ˜;
            filter: drop-shadow(0 0 10px rgba(255,192,203,0.8));æ»¤é•œï¼šæŠ•å½±ï¼ˆ0 0 10px rgba(255,192,203,0.8)ï¼‰ï¼›
        }
        @keyframes float-banner { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }@keyframes float-banner {0%, 100% {transform: translateY(0)ï¼›} 50% {transform: translateY(-15px)ï¼›}}

        #protocol-warning {
            position: fixed; top: 0; left: 0; width: 100%; background: #ff4444; color: white;ä½ç½®:å›ºå®š;ä¸Šå›¾:0;å·¦:0;å®½åº¦:100%;èƒŒæ™¯:# ff4444;é¢œè‰²:ç™½è‰²;
            text-align: center; padding: 10px; z-index: 10000; font-size: 14px; display: none;text   æ–‡æœ¬-align   å¯¹é½:ä¸­å¿ƒ;å¡«å……:10 px;z - index   æŒ‡æ•°: 10000;å­—ä½“å¤§å°:14 px;æ˜¾ç¤º:æ²¡æœ‰;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);Box   ç›’å­-shadow   å½±å­: 0 2px 10px rgba(0,0,0,0.5)ï¼›
        }
        
        #cam-preview-container {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);è¿‡æ¸¡ï¼šæ‰€æœ‰0.3sç«‹æ–¹bezier(0.4, 0,0.2, 1)ï¼›
        }
        #cam-preview-container:hover {# cam   å‡¸è½®-preview   é¢„è§ˆ-container   å®¹å™¨:{å¾˜å¾Š
            transform: scale(1.05);   å˜æ¢:è§„æ¨¡(1.05);
            opacity: 1;   é€æ˜åº¦:1;
        }
        
        @keyframes neon-pulse {
            0%, 100% { text-shadow: 0 0 10px rgba(255,105,180,0.7), 0 0 20px rgba(255,105,180,0.5); }0%, 100% {text   æ–‡æœ¬-shadow: 00 10px rgba(255,105,180,0.7), 00 20px rgba(255,105,180,0.5)ï¼›}
            50% { text-shadow: 0 0 20px rgba(255,105,180,0.9), 0 0 30px rgba(255,105,180,0.7), 0 0 40px rgba(255,105,180,0.5); }50% {text   æ–‡æœ¬-shadow: 0 0 20px rgba(255,105,180,0.9), 0 0 30px rgba(255,105,180,0.7), 0 0 40px rgba(255,105,180,0.5)ï¼›}
                                                                         }
        .neon-pulse { animation: neon-pulse 2s infinite; }ï¼éœ“è™¹è„‰å†²{åŠ¨ç”»ï¼šéœ“è™¹è„‰å†²2sæ— é™ï¼›}

        /* éšè—çš„æ—¥å¿—å®¹å™¨ */
        #debug-console { display: none; }#debug   #è°ƒè¯•-console   æ§åˆ¶å°{æ˜¾ç¤ºï¼šnoneï¼›}

        /* æ»šåŠ¨æ–‡å­—åŒºåŸŸæ ·å¼ */
        .scrollable-text {   ï¼scrollable   .scrollable   å¯æ»šåŠ¨-textâ€”â€”   æ–‡æœ¬,
            max-height: 240px; /* é™åˆ¶é«˜åº¦ */
            overflow-y: auto;  /* å…è®¸å‚ç›´æ»šåŠ¨ */
            padding-right: 10px; /* ç»™æ»šåŠ¨æ¡ç•™ç‚¹ç©º */
            scrollbar-width: thin; /* Firefox */scrollbar   æ»šåŠ¨æ¡-width   å®½åº¦:è–„;/* Firefox */
            scrollbar-color: rgba(255,105,180,0.5) transparent; /* Firefox */æ»šåŠ¨æ¡é¢œè‰²ï¼šrgbaï¼ˆ255,105,180,0.5ï¼‰é€æ˜ï¼›/* Firefox */
        }
        /* Chrome/Safari æ»šåŠ¨æ¡æ ·å¼ */
        .scrollable-text::-webkit-scrollbar {ï¼scrollable   .scrollable   å¯æ»šåŠ¨-text   æ–‡æœ¬:: -webkit-scrollbarâ€”â€”   æ»šåŠ¨æ¡,
            width: 4px;   å®½åº¦:4 px;
        }
        .scrollable-text::-webkit-scrollbar-track {ï¼æ»šåŠ¨æ–‡æœ¬:-webkit-scrollbar   æ»šåŠ¨æ¡-track   è·Ÿè¸ª {
            background: transparent;   èƒŒæ™¯:é€æ˜;
        }
        .scrollable-text::-webkit-scrollbar-thumb {ï¼æ»šåŠ¨æ–‡æœ¬:-webkit-scrollbar   æ»šåŠ¨æ¡-thumb   æ‹‡æŒ‡ {
            background-color: rgba(255, 105, 180, 0.5);Background   èƒŒæ™¯-color   é¢œè‰²: rgba(255,105,180,0.5)ï¼›
            border-radius: 10px;
        }
    </style>   > < /é£æ ¼
</head>   < / >è´Ÿè´£äºº
<body>   èº«ä½“< >
    
    <div id="debug-console"></div>< div id = "è°ƒè¯•æ“æ§å°" > < / div >

    <div id="protocol-warning">
        âš ï¸ æ£€æµ‹åˆ°æ‚¨ç›´æ¥æ‰“å¼€äº†HTMLæ–‡ä»¶ (file://)ã€‚<br>æ‘„åƒå¤´å’Œéº¦å…‹é£å°†è¢«æ‹¦æˆªã€‚<br>
        <b>è¯·åœ¨ VS Code ä¸­å®‰è£… "Live Server" æ’ä»¶å¹¶ä½¿ç”¨ "Open with Live Server" è¿è¡Œã€‚</b>
    </div>

    <audio id="bgm" loop>   <éŸ³é¢‘id="bgm"   â€œbgmâ€å¾ªç¯>
        <source src="./src/happy-birthday-155461.mp3" type="audio/mpeg">
    </audio>   < /éŸ³é¢‘>

    <video class="input_video" playsinline></video>
    <div id="canvas-container"></div>< div id = "ç”»å¸ƒå®¹å™¨" > < / div >
    
    <button id="floating-gift-btn" class="hidden safe-click-area" title="æŸ¥çœ‹ç¥ç¦">ğŸ</button>

    <!-- å¯åŠ¨é¡µ -->
    <div id="start-overlay">
        <div class="text-center max-w-md p-8 glass-panel start-card mx-4 animate-float">< span    è·¨åº¦style   é£æ ¼ =" font - familyï¼šå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“
            <h1 class="text-6xl mb-2 font-handwriting text-transparent bg-clip-text bg-gradient-to-r from-pink-300 to-purple-400 drop-shadow-lg">Happy Birthday</h1>< span style =" font- family - family - family - family - family - family - family - family - family - family - family - family - family - family - family - family â€œç”Ÿæ—¥å¿«ä¹
            <!-- <h2 class="text-4xl mb-6 font-bold text-white tracking-widest neon-text">ç²‰å§</h2> -->ï¼œ!â€”â€”
            <div class="space-y-4 text-gray-200 text-lg mb-8 font-light">< span    è·¨åº¦style   é£æ ¼ =" font- familyï¼šå®‹ä½“-å®‹ä½“-å®‹ä½“
                <p>ğŸ‘‹ <b>å¯¹ç€é•œå¤´ ä¸¾èµ·åŒæ‰‹</b> å”¤é†’é­”æ³•</p>
                <p>ğŸ’¨ <b>æŒç»­å¹æ°”</b> è®¸ä¸‹å¿ƒæ„¿</p>
            </div>
            <button id="start-btn" class="safe-click-area px-12 py-4 bg-gradient-to-r from-pink-600 to-purple-700 rounded-full font-bold text-xl hover:scale-105 active:scale-95 transition transform shadow-[0_0_20px_rgba(255,105,180,0.5)] text-white border border-white/20 cursor-pointer z-50">[0_0_20px_rgba(255,105,180,0.5)] [font   å­—ä½“- familyï¼šå®‹ä½“][font   å­—ä½“- familyï¼šå®‹ä½“]font   å­—ä½“- familyï¼šå®‹ä½“][font   å­—ä½“- familyï¼šå®‹ä½“]font   å­—ä½“- familyï¼šå®‹ä½“][font   å­—ä½“- familyï¼šå®‹ä½“]font   å­—ä½“- familyï¼šå®‹ä½“
                è¿›å…¥é­”æ³•ä¸–ç•Œ
            </button>   > < /æŒ‰é’®
            <div id="loading-text" class="hidden mt-4 text-pink-300 text-sm">æ­£åœ¨ç¼–ç»‡æ˜Ÿå…‰...</div>
        </div>
    </div>

    <div id="blow-hint"><p class="text-lg font-bold text-pink-200 mb-1">ğŸ¤ å¯¹ç€éº¦å…‹é£å¹æ°”</p><p class="text-xs text-gray-400">(å¦‚æœéº¦å…‹é£ä¸çµå¯ä»¥å°è¯•ç”µè„‘é•¿æŒ‰ç©ºæ ¼ Â· æ‰‹æœºé•¿æŒ‰å±å¹•)</p></div>
    <div id="blow-meter-container"><div id="blow-meter-bar"></div></div>

    <div id="top-banner" class="hidden">
        <h1 class="text-6xl md:text-8xl banner-text">Happy Birthday</h1>< span style =â€œ font - familyï¼šå®‹ä½“â€ < span style =" font - familyï¼šå®‹ä½“
        <p class="text-pink-200/70 text-lg mt-2 tracking-widest uppercase">Best Wishes for You</p>< span style =" font - family - family - family - family " < span style =â€œ font - family - family - family - family - family â€
    </div>

    <!-- UI å±‚ -->
    <div id="ui-layer" style="display: none;">< span    è·¨åº¦style   é£æ ¼=â€œ font   å­—ä½“ - familyï¼šå®‹ä½“ï¼›â€>
        <div class="flex justify-between items-start w-full">< span    è·¨åº¦class   ç±»=" font - familyï¼šå®‹ä½“
            <div class="glass-panel px-4 py-2">
                <div id="status-dot" class="inline-block w-2 h-2 rounded-full bg-red-500 mr-2 shadow-[0_0_8px_red]"></div>
                <span id="status-text" class="text-xs md:text-sm text-gray-300 tracking-wider">SYSTEM READY</span>SYSTEM READY
            </div>
            <div class="flex gap-2">   < span    è·¨åº¦class   ç±»=" font - familyï¼šå®‹ä½“
                <button id="settings-toggle" class="interactive-element p-3 glass-panel hover:bg-white/20 transition rounded-full active:scale-90 text-sm">ğŸ¨</button>ğŸ¨
                <button id="music-btn" class="interactive-element p-3 glass-panel hover:bg-white/20 transition rounded-full active:scale-90">ğŸµ</button>ğŸµ
            </div>
        </div>
        
        <div id="settings-panel">   < div id = "è®¾ç½®é¢æ¿" >
            <div class="color-control"><span>åº•å±‚é¢œè‰²</span><input type="color" id="picker-bottom" value="#FF69B4"></div>
            <div class="color-control"><span>é¡¶å±‚é¢œè‰²</span><input type="color" id="picker-top" value="#FFB6C1"></div>
            <div class="color-control"><span>å¥¶æ²¹é¢œè‰²</span><input type="color" id="picker-cream" value="#FFFFFF"></div>
        </div>

        <div id="center-instruction" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none w-full z-0">
            <div class="flex items-center justify-center gap-4 mb-2">< span    è·¨åº¦style   é£æ ¼ =" font - familyï¼šå®‹ä½“
                <span id="hand-icon" class="text-6xl animate-bounce">ğŸ‘‹</span>ğŸ‘‹
                <h2 id="instruction-text" class="text-6xl md:text-8xl font-bold text-white neon-pulse transition-all duration-700">ä¸¾èµ·åŒæ‰‹</h2> 
            </div>
            <p id="sub-instruction" class="mt-4 text-xl md:text-2xl text-pink-200/80 font-light tracking-[0.3em]">è®©é­”æ³•å‘ç”Ÿ</p>
            <!-- è‡ªåŠ¨å€’æ•°æç¤ºæ–‡å­— -->
            <p id="auto-countdown-text" class="mt-4 text-sm text-pink-200/60 font-light tracking-wider animate-pulse hidden"></p>< span style =" font- family - family - family - family - family - family - family - family - family - family - family - family
        </div>

        <!-- æ‘„åƒå¤´é¢„è§ˆæ¡† -->
        <div id="cam-preview-container" class="absolute bottom-6 left-6 z-50 opacity-90 hover:opacity-100">
            <div class="glass-panel p-2 rounded-xl border border-white/10 shadow-[0_8px_32px_rgba(0,0,0,0.5)]">< span    è·¨åº¦class   ç±»="glass-panel p-2 round -xl border-white/10 shadow-[0_8px_32px_rgba(0,0,0,0.5)]"ç»ç’ƒé¢æ¿p-2åœ†å½¢-xlè¾¹æ¡†-ç™½è‰²/10é˜´å½±-[0_8px_32px_rgba(0,0,0,0.5)]
                <div class="relative w-36 h-28 bg-black/40 rounded-lg overflow-hidden border border-white/5">< span    è·¨åº¦class   ç±»=" font - familyï¼šå®‹ä½“ï¼›font - familyï¼šå®‹ä½“ï¼›font - familyï¼šå®‹ä½“
                     <canvas id="output_canvas" width="160" height="120" class="w-full h-full object-cover transform scale-x-[-1]"></canvas>
                     <div class="absolute top-2 right-2 flex items-center gap-1 bg-black/60 px-1.5 py-0.5 rounded-full backdrop-blur-sm">< span    è·¨åº¦style =" font - familyï¼šå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“
                        <div id="cam-status-dot" class="w-1.5 h-1.5 rounded-full bg-red-500 transition-colors duration-300"></div>
                        <span id="cam-status-text" class="text-[8px] text-red-400 font-mono">NO HAND   æ‰‹</span>
                     </div>
                </div>
                <div class="text-center mt-1.5">< span    è·¨åº¦style =â€œ font   å­—ä½“ - family   å®¶åº­ - family    å®¶åº­â€
                    <p class="text-[10px] text-pink-200/70 tracking-widest uppercase scale-90">Camera View   è§†å›¾</p>
                </div>
            </div>
        </div>
    </div>

    <!-- æƒŠå–œå±‚ -->
    <div id="surprise-layer" class="hidden">
        <button id="reveal-btn" class="safe-click-area hidden px-10 py-5 bg-white text-pink-600 rounded-full font-bold text-2xl shadow-[0_0_60px_rgba(255,105,180,0.8)] hover:scale-105 transition-transform duration-300 animate-float">ğŸ æ‰“å¼€ç¤¼ç‰©</button>ğŸ
        
        <!-- å¡ç‰‡å®¹å™¨ -->
        <div id="flip-card-container" class="hidden flip-card w-full max-w-sm md:max-w-md aspect-[3/4] mx-6 pop-in">
            <div class="flip-card-inner">
                
                <!-- æ­£é¢ï¼šå¼•å¯¼å¼€å¯ -->
                <div class="flip-card-front glass-panel bg-gradient-to-br from-pink-500/40 to-purple-600/40 border border-white/30 p-1">< span    è·¨åº¦style   é£æ ¼ =" font - familyï¼šå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“
                    <div class="bg-black/80 rounded-[1rem] p-6 h-full flex flex-col backdrop-blur-md">< span    è·¨åº¦style   é£æ ¼ =â€œ font   å­—ä½“ - familyï¼šå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“â€
                        <div class="w-full aspect-[4/3] bg-gray-800 rounded-lg mb-6 overflow-hidden relative border border-white/10 shadow-inner">< span    è·¨åº¦class   ç±»=" font - family -å®‹ä½“-å®‹ä½“-å®‹ä½“-å®‹ä½“-å®‹ä½“-å®‹ä½“-å®‹ä½“
                            <img src="https://bpic.588ku.com/Templet_origin_pic/05/19/43/8c971b1364922e551b4fbccb2d5719d2.jpg" class="w-full h-full object-cover" alt="Gift">
                            <div class="absolute bottom-3 left-4 text-white/90 font-handwriting text-2xl">Happy Birthday   ç”Ÿæ—¥!</div>< span class="absolute bottom-3 left-4 text-white/ 90font   å­—ä½“ -handwriting    ç¬”è¿¹text   æ–‡æœ¬-2xl">ç”Ÿæ—¥å¿«ä¹ï¼< / div >
                        </div>
                        <div class="text-center mt-auto mb-8">< span    è·¨åº¦style   é£æ ¼ =â€œ font   å­—ä½“ - family   å®¶åº­ - family   å®¶åº­ - family    å®¶åº­â€
                            <p class="text-gray-300 mb-6 font-light leading-relaxed">è¿™ä¸ä»…ä»…æ˜¯ä¸€åœºæ•°å­—çƒŸèŠ±ï¼Œ<br>æ›´æ˜¯ä¸ºä½ å‡†å¤‡çš„ä¸“å±æ—¶åˆ»ã€‚</p>
                            <button id="next-surprise-btn" class="safe-click-area w-full py-3 bg-gradient-to-r from-pink-600 to-purple-700 rounded-xl font-bold text-white shadow-lg hover:brightness-110 active:scale-95 transition">What's the surprise? âœ¨</button> < /æŒ‰é’®
                        </div>
                    </div>
                </div>

                <!-- èƒŒé¢ï¼šç¥ç¦å†…å®¹ (åˆ†é¡µæ˜¾ç¤º) -->
                <div class="flip-card-back glass-panel bg-gradient-to-br from-purple-500/40 to-blue-600/40 border border-white/30 p-1">< span    è·¨åº¦style   é£æ ¼ =" font - familyï¼šå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“
                    <div class="bg-black/90 rounded-[1rem] p-8 h-full flex flex-col items-center justify-center backdrop-blur-md">< span    è·¨åº¦style   é£æ ¼ =â€œ font   å­—ä½“ - familyï¼šå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“ï¼Œå®‹ä½“â€
                        
                        <!-- ç¬¬ä¸€é¡µï¼šç”Ÿæ—¥ç¥ç¦ (å¸¦ç…§ç‰‡) -->
                        <div id="card-page-1" class="w-full h-full flex flex-col">
                            <div class="mb-4 text-5xl animate-bounce text-center">ğŸ’Œ</div>< span style =" font - family - family - family - family - family - family - family - family - family - family - family - family - family - family - family - family
                            <h3 class="text-2xl font-bold text-pink-300 mb-6 font-handwriting text-center">è‡´æœ€ç‰¹åˆ«çš„ä½ </h3>< span style =" font- family - family - family - family - family - family - family - family - family - family - family - family " 
                            <div id="typewriter-text-1" class="text-left text-gray-200 space-y-4 font-light leading-7 text-sm md:text-base border-l-2 border-pink-500/50 pl-4 mb-4 flex-grow scrollable-text"></div>< span style =" font- familyï¼šå®‹ä½“ï¼›font- familyï¼šå®‹ä½“ï¼›font- familyï¼šå®‹ä½“ï¼›font- familyï¼šå®‹ä½“
                            
                            <button id="to-page-2-btn" class="safe-click-area px-6 py-2 mt-auto rounded-full bg-white/10 text-pink-200 hover:bg-white/20 transition text-sm flex items-center justify-center mx-auto">< span    è·¨åº¦style   é£æ ¼ =â€œ font   å­—ä½“ - family   å®¶åº­ - family   å®¶åº­ - family   å®¶åº­ - family   å®¶åº­ - family   å®¶åº­ - family   å®¶åº­ - family   å®¶åº­ - family   å®¶åº­ - family   å®¶åº­ - family   å®¶åº­ - family    å®¶åº­â€
                                è¿˜æœ‰è¯å¯¹ä½ è¯´... <span class="ml-2">ğŸ‘‰</span>
                            </button>   > < /æŒ‰é’®
                        </div>

                        <!-- ç¬¬äºŒé¡µï¼šå¿«é€’ä¿¡æ¯ (çº¯æ–‡å­—ï¼Œå¸¦æ»šåŠ¨) -->
                        <div id="card-page-2" class="w-full h-full flex flex-col hidden">
                            <h3 class="text-xl font-bold text-purple-300 mb-4 font-handwriting text-center mt-2">ä¸€ç‚¹å°å°çš„æ­‰æ„</h3>< span style =" font- family - family - family - family - family - family - family - family - family - family - family
                            <!-- æ»šåŠ¨åŒºåŸŸ -->
                            <div id="typewriter-text-2" class="text-left text-gray-200 space-y-3 font-light leading-6 text-sm md:text-base border-l-2 border-purple-500/50 pl-4 mb-4 flex-grow scrollable-text h-full"></div>< span style =" font- familyï¼šå®‹ä½“ï¼›font- familyï¼šå®‹ä½“ï¼›font- familyï¼šå®‹ä½“ï¼›font- familyï¼šå®‹ä½“ï¼›font- familyï¼šå®‹ä½“
                            
                            <button id="close-card-btn" class="safe-click-area px-8 py-2 mt-auto rounded-full border border-white/30 text-gray-300 hover:bg-white/10 hover:text-white transition text-sm mx-auto">class   ç±»=" font - familyï¼šå®‹ä½“ï¼›font - familyï¼šå®‹ä½“ï¼›font - familyï¼šå®‹ä½“ï¼›font - familyï¼šå®‹ä½“   å­—ä½“
                                æ”¶èµ·å¡ç‰‡
                            </button>   > < /æŒ‰é’®
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>   < >è„šæœ¬
        // --- è°ƒè¯•æ—¥å¿—å·¥å…· ---
        const debugConsole = document.getElementById('debug-console');const   å¸¸é‡ debugConsole = document   æ–‡æ¡£.getElementById('debug-console'   è°ƒè¯•æ“æ§å°çš„)ï¼›
        function log(msg) {   å‡½æ•°æ—¥å¿—ï¼ˆmsgï¼‰ {
            if (debugConsole) {   å¦‚æœï¼ˆdebugConsoleï¼‰ {
                const time = new Date().toLocaleTimeString();const   å¸¸é‡   æ—¶é—´ time   æ—¶é—´ = new   æ–°    æ—¥æœŸDate   æ—¥æœŸ().toLocaleTimeString()ï¼›
                debugConsole.innerHTML += `[${time}] ${msg}<br>`;debugConsoleã€‚innerHTML = ' [${time}] ${msg}
 ';
            }
            console.log(msg);   console   æ§åˆ¶å°.log   æ—¥å¿—(å‘³ç²¾);
        }

        const IS_MOBILE = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);const   å¸¸é‡ IS_MOBILE = /Android|webOS|iPhone|iPad|iPod|é»‘è“|IEMobile|Opera Mini/i/Android    å®‰å“b| webOS    ç½‘ç»œæ“ä½œç³»ç»Ÿb| iPhone b| iPad b| iPod|æ‰‹æœº|æ‰‹æœº|Opera Mini.test   æµ‹è¯•(navigator   å¯¼èˆªå™¨.userAgent)ï¼›
        
        if (window.location.protocol === 'file:') {å¦‚æœ(window   çª—å£.locationã€‚åè®®=== â€˜æ–‡ä»¶ï¼šâ€™){
            document.getElementById('protocol-warning').style.display = 'block';.style   é£æ ¼ . getelementbyid(â€œprotocol   â€åè®®-warningâ€   è­¦å‘Šâ€)ã€‚Display   ã€‚æ˜¾ç¤º = 'block'   â€œå—â€ï¼›
        }

        // --- å…¨å±€å˜é‡ä¸é…ç½® ---
        const CAKE_THEME = { bottom: "#FF69B4", top: "#FFB6C1", cream: "#FFFFFF" };const   å¸¸é‡ CAKE_THEME = {bottom   åº•: "#FF69B4"   â€œ# FF69B4â€, top   å‰: "#FFB6C1"   â€œ# FFB6C1â€, cream   å¥¶æ²¹: "#FFFFFF"}ï¼›
        const VISUAL_CONFIG = { particleCount: IS_MOBILE ? 4000 : 7500, color: 0xff69b4, blowThreshold: 25, blowMaxDuration: 100 };const   å¸¸é‡ VISUAL_CONFIG = {particleCount: IS_MOBILE ï¼Ÿ4000: 7500ï¼Œé¢œè‰²ï¼š0xff69b4ï¼Œ blowThreshold: 25, blowMaxDuration: 100}ï¼›
        const STATE = { INTRO: -1, IDLE: 0, COUNTDOWN: 1, CAKE: 2, BLOWING: 3, CELEBRATION: 4 };const   å¸¸é‡   çŠ¶æ€ STATE   çŠ¶æ€ = {INTRO   ä»‹ç»: -1, IDLE   é—²ç½®: 0, COUNTDOWN   å€’è®¡æ—¶: 1, CAKE   è›‹ç³•: 2, blow   æ‰“å‡»: 3, CELEBRATION   åº†ç¥æ´»åŠ¨: 4}ï¼›
        
        let currentState = STATE.INTRO;let   è®©   ç°çŠ¶å currentState   ç°çŠ¶å = STATE   çŠ¶æ€.INTROï¼›   ä»‹ç»;
        let interactionMode = 0;    è®©interactionMode = 0ï¼›
        
        let particlesData = [];   let   è®© particlesData = []ï¼›
        let scene, camera, renderer, particleSystem;è®©åœºæ™¯ã€ç›¸æœºã€æ¸²æŸ“å™¨ã€ç²’å­ç³»ç»Ÿï¼›
        let time = 0;   è®¾time = 0ï¼›
        let shapeCache = {};    è®©shape = {}ï¼›
        let blowProgress = 0;   è®©blowProgress = 0ï¼›
        let isSpacePressed = false;    let   è®© isSpacePressed = falseï¼›   è™šå‡çš„;
        let isTouching = false;    let   è®© isTouching = falseï¼›   è™šå‡çš„;
        
        let rotationVelocity = 0;   è®¾rotationVelocity = 0ï¼›
        let isDragging = false;   let   è®© isdrag = falseï¼›   è™šå‡çš„;
        let previousMouseX = 0;   è®©previousMouseX = 0ï¼›
        let lastHandX = 0;   let   è®© lastandx = 0ï¼›
        let autoRotateSpeed = 0.005;è®¾autorotatspeed = 0.005ï¼›

        // --- è‡ªåŠ¨å€’æ•°å˜é‡ ---
        let autoEntryTimer = null;   è®©autoEntryTimer = nullï¼›   é›¶;
        let autoEntrySeconds = 10;   è¯·æ³¨æ„è‡ªåŠ¨è¾“å…¥ç§’= 10;
        
        let audioContext, analyser;è®©audioContextï¼Œåˆ†æå™¨ï¼›
        const bgm = document.getElementById('bgm');const   å¸¸é‡ bgm = document   æ–‡æ¡£.getElementById('bgm'   â€œbgmâ€)ï¼›

        const ui = {
            startOverlay: document.getElementById('start-overlay'),startOverlay: . getelementbyid(â€œstart   â€œå¼€å§‹-overlayâ€   è¦†ç›–â€),
            uiLayer: document.getElementById('ui-layer'),uiLayer:æ–‡ä»¶ã€‚getElementById(â€œui   â€œiu-layerâ€   å±‚â€),
            statusText: document.getElementById('status-text'),statusText: . getelementbyid(â€œçŠ¶æ€æ–‡æœ¬â€),
            statusDot: document.getElementById('status-dot'),statusDot: . getelementbyid(â€œstatus   â€çŠ¶æ€-dotâ€   ç‚¹â€),
            mainText: document.getElementById('instruction-text'),mainText: . getelementbyid(â€œinstruction   â€æŒ‡ä»¤-textâ€   æ–‡æœ¬â€),
            subText: document.getElementById('sub-instruction'),æ½œå°è¯:. getelementbyid(â€œsub   â€œå­-instructionâ€   æŒ‡ä»¤â€),
            handIcon: document.getElementById('hand-icon'),handIcon: . getelementbyid(æŒ‡é’ˆå›¾æ ‡),
            blowMeter: document.getElementById('blow-meter-container'),blowMeter: . getelementbyid(â€œblow   â€œæ‰“å‡»-meter   è®¡-containerâ€   å®¹å™¨â€),
            blowBar: document.getElementById('blow-meter-bar'),blowBar: . getelementbyid(â€œblow   â€œæ‰“å‡»-meter   è®¡-barâ€   é…’å§â€),
            blowHint: document.getElementById('blow-hint'),blowHint: . getelementbyid(â€œblow   â€œæ‰“å‡»-hintâ€   æç¤ºâ€œ),
            surpriseLayer: document.getElementById('surprise-layer'),surpriseLayer: . getelementbyid(â€œsurprise   â€œæƒŠå–œ-layerâ€   å±‚â€),
            revealBtn: document.getElementById('reveal-btn'),revealBtn: . getelementbyid(â€œreveal   â€œæ­éœ²-btnâ€   btn "),
            floatingGiftBtn: document.getElementById('floating-gift-btn'),floatingGiftBtn: document   æ–‡æ¡£.getElementById (floating   æµ®åŠ¨-gift   ç¤¼ç‰©-btnâ€   btn "),
            cardContainer: document.getElementById('flip-card-container'), cardContainer: . getelementbyid(â€œflip   â€œæŠ›-card   å¡-containerâ€   å®¹å™¨â€),
            nextBtn: document.getElementById('next-surprise-btn'),nextBtn: document   æ–‡æ¡£.getElementById (next   ä¸‹ä¸€ä¸ª-surprise   æƒŠå–œ-btnâ€   btn "),
            closeBtn: document.getElementById('close-card-btn'),closeBtn: document   æ–‡æ¡£.getElementById (close   å…³é—­-card   å¡-btnâ€   btn "),
            settingsPanel: document.getElementById('settings-panel'),settingsPanel: . getelementbyid(â€œè®¾ç½®é¢æ¿â€),
            settingsToggle: document.getElementById('settings-toggle'),settingsToggle: . getelementbyid(â€œsettings   â€œè®¾ç½®-toggleâ€   åˆ‡æ¢â€),
            topBanner: document.getElementById('top-banner'),topBanner: . getelementbyid(é¡¶éƒ¨æ¨ªå¹…)
            startBtn: document.getElementById('start-btn'),startBtn: document   æ–‡æ¡£.getElementById (start   å¼€å§‹-btnâ€   btn "),
            loadingText: document.getElementById('loading-text'),loadingText: . getelementbyid(â€œè£…è½½æ–‡æœ¬â€),
            camStatusDot: document.getElementById('cam-status-dot'),camStatusDot: . getelementbyid(â€œcam   â€œå‡¸è½®-status   çŠ¶æ€-dotâ€   ç‚¹â€),
            camStatusText: document.getElementById('cam-status-text'),camStatusText: . getelementbyid(â€œcam   â€œå‡¸è½®-status   çŠ¶æ€-textâ€   æ–‡æœ¬â€),
            // å¡ç‰‡ç›¸å…³ UI
            page1: document.getElementById('card-page-1'),æ‰€è¿°:. getelementbyid(â€œcard   â€ç‰Œ-page   é¡µé¢-1â€),
            page2: document.getElementById('card-page-2'),æ‰€ä»¥page2: . getelementbyid(â€œcard   â€ç‰Œ-page   é¡µé¢-2â€),
            toPage2Btn: document.getElementById('to-page-2-btn'),
            textContainer1: document.getElementById('typewriter-text-1'),textContainer1: . getelementbyid(â€œtypewriter   â€œæ‰“å­—æœº-text   æ–‡æœ¬-1â€),
            textContainer2: document.getElementById('typewriter-text-2'),textContainer2: . getelementbyid(â€œtypewriter   â€œæ‰“å­—æœº-text   æ–‡æœ¬-2â€),
            // è‡ªåŠ¨å€’æ•°æ–‡æœ¬
            autoCountdownText: document.getElementById('auto-countdown-text')autoCountdownText: . getelementbyid(â€œauto   â€œè‡ªåŠ¨-countdown   å€’è®¡æ—¶-textâ€   æ–‡æœ¬â€)
        };

        // ç«‹å³åˆå§‹åŒ– Three.js
        initThree();

        function initThree() {   initThree() {
            const container = document.getElementById('canvas-container');const   å¸¸é‡   å®¹å™¨ container   å®¹å™¨ = document   æ–‡æ¡£.getElementById('canvas-container'   â€œç”»å¸ƒå®¹å™¨â€)ï¼›
            scene = new THREE.Scene();   scene   åœºæ™¯ = new   æ–° THREE   ä¸‰ä¸ª.Scene   åœºæ™¯()ï¼›
            scene.fog = new THREE.FogExp2(0x000000, 0.002);ç°åœºã€‚é›¾=æ–°çš„ä¸‰ã€‚FogExp2 (0 x000000, 0.002);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);ç›¸æœº=æ–°çš„ä¸‰ã€‚PerspectiveCamera(75å¹´,çª—å£ã€‚innerWidth / windowã€‚innerHeight   çª—å£ã€‚innerHeight, 0.1, 1000)ï¼›
            camera.position.z = 50;   Camera   ç›¸æœº.position   ä½ç½®.z = 50ï¼›
            renderer = new THREE.WebGLRenderer({ antialias: !IS_MOBILE, alpha: true, powerPreference: "high-performance" });renderer   æ¸²æŸ“å™¨ = new   æ–°    ä¸‰ã€‚WebGLRendererTHREEã€‚WebGLRenderer   ä¸‰ã€‚WebGLRenderer({antialias   æŠ—é”¯é½¿: ï¼IS_MOBILE, alpha   Î±: true   çœŸæ­£çš„, powerPreference: â€œé«˜æ€§èƒ½â€})ï¼›
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            container.appendChild(renderer.domElement);
            preloadShapes();
            createParticles();
            window.addEventListener('resize', () => {çª—å£ã€‚addEventListener('resize'   â€œè°ƒæ•´â€, () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            const onStart = (x) => {
                if(interactionMode === 1) {
                    isDragging = true;
                    previousMouseX = x;   preousmousex = xï¼›   x;
                    rotationVelocity = 0;    rotationVelocity = 0ï¼›
                }
            };
            const onMove = (x) => {
                if(isDragging && interactionMode === 1) {if   å¦‚æœ(isdrag && interactionMode === 1) {
                    const delta = x - previousMouseX;const   å¸¸é‡   Î´ delta   Î´ = x - preousmousexï¼›
                    const sensitivity = IS_MOBILE ? 0.015 : 0.008; constçµæ•åº¦= IS_MOBILE ï¼Ÿ0.015: 0.008ï¼›
                    rotationVelocity = delta * sensitivity;rotationVelocity = delta   Î´ *çµæ•åº¦ï¼›
                    particleSystem.rotation.y += rotationVelocity;particlessystem . rotate   æ—‹è½¬ .y = rotationVelocityï¼›   rotationVelocity;
                    previousMouseX = x;   preousmousex = xï¼›   x;
                }
            };
            const onEnd = () => { isDragging = false; };const   å¸¸é‡   ç«–ç€ onEnd   ç«–ç€ = () => {isdrag = falseï¼›   è™šå‡çš„;}ï¼›

            container.addEventListener('mousedown', (e) => onStart(e.clientX));å®¹å™¨ã€‚addEventListener('mousedown'   â€œmousedownâ€, (e) => onStart(e. clientx))ï¼›
            window.addEventListener('mousemove', (e) => onMove(e.clientX));çª—å£ã€‚addEventListener(' mousmove '   â€œé¼ æ ‡ç§»åŠ¨â€, (e) => onMove(e.f lix))ï¼›
            window.addEventListener('mouseup', onEnd);çª—å£ã€‚addEventListener (mouseup,ç«–ç€);

            container.addEventListener('touchstart', (e) => onStart(e.touches[0].clientX), {passive: false});containerã€‚addEventListenerå®¹å™¨ã€‚addEventListener('touchstart'   â€™touchstartâ€™, (e) => onStart(e.touches   è§¦æ‘¸[0]ã€‚clientX), {passive   è¢«åŠ¨: false   å‡})ï¼›
            window.addEventListener('touchmove', (e) => {çª—å£ã€‚addEventListener('touchmove'   â€œtouchmoveâ€, (e) => {
                if(isDragging) e.preventDefault(); å¦‚æœisDragging e.preventDefault ();
                onMove(e.touches[0].clientX);
            }, {passive: false});   }ï¼Œ{è¢«åŠ¨ï¼šfalse})ï¼›
            window.addEventListener('touchend', onEnd);çª—å£ã€‚addEventListener(â€™touchendâ€™onEnd   â€œtouchend 'onEnd);
            
            render();   å‘ˆç°();
        }

        function createParticles() {å‡½æ•°createParticles() {
            const geometry = new THREE.BufferGeometry();const   å¸¸é‡   å‡ ä½• geometry = new   æ–° THREE   ä¸‰ä¸ª.BufferGeometry()ï¼›
            const positions = new Float32Array(VISUAL_CONFIG.particleCount * 3);const   å¸¸é‡   ä½ç½® position = new   æ–° Float32Arrayï¼ˆVISUAL_CONFIGFloat32Array (VISUAL_CONFIG. confï¼‰   é…ç½®)* 3)ï¼›
            const colors = new Float32Array(VISUAL_CONFIG.particleCount * 3);const   å¸¸é‡   é¢œè‰² colors = new   æ–° Float32Arrayï¼ˆVISUAL_CONFIGFloat32Array (VISUAL_CONFIG. confï¼‰   é…ç½®)* 3)ï¼›
            const sizes = new Float32Array(VISUAL_CONFIG.particleCount);const   å¸¸é‡   å¤§å° size = new   æ–° Float32Array(VISUAL_CONFIG.particleCount)ï¼›
            particlesData = [];
            const c = new THREE.Color(VISUAL_CONFIG.color);const   å¸¸é‡ c = new   æ–° THREE   ä¸‰ä¸ª.Color   é¢œè‰²(VISUAL_CONFIG.color   é¢œè‰²)ï¼›

            for (let i = 0; i < VISUAL_CONFIG.particleCount; i++) {for   ä¸º (let   è®©   æˆ‘ i   æˆ‘ = 0; i   æˆ‘ < VISUAL_CONFIG.particleCount; i   æˆ‘) {
                const x = (Math.random() - 0.5) * 300;const   å¸¸é‡ x = (éšæœºï¼ˆï¼‰- 0.5)* 300ï¼›
                const y = (Math.random() - 0.5) * 300;const   å¸¸é‡ y =ï¼ˆæ•°å­¦ï¼‰éšæœºï¼ˆï¼‰- 0.5)* 300ï¼›
                const z = (Math.random() - 0.5) * 200;const   å¸¸é‡ z =ï¼ˆæ•°å­¦ï¼‰éšæœºï¼ˆï¼‰- 0.5)* 200ï¼›
                positions[i * 3] = x; positions[i * 3 + 1] = y; positions[i * 3 + 2] = z;ä½ç½®[i   æˆ‘ * 3] = xï¼›ä½ç½®[i   æˆ‘ * 3 1] = yï¼›ä½ç½®[i   æˆ‘ * 3 2] = zï¼›   z;
                colors[i * 3] = c.r; colors[i * 3 + 1] = c.g; colors[i * 3 + 2] = c.b;color   é¢œè‰² [i   æˆ‘ * 3] = c.rï¼›color   r;é¢œè‰² [i   æˆ‘ * 31] = cï¼›color   c;é¢œè‰² [i   æˆ‘ * 32] = c.bï¼›   b;
                sizes[i] = Math.random() * 2;size   å¤§å° [i   æˆ‘] = Math   æ•°å­¦.random   éšæœº() * 2ï¼›
                particlesData.push({
                    current: new THREE.Vector3(x, y, z),å½“å‰ï¼šæ–°çš„ä¸‰ä¸ªã€‚å‘é‡3(x, y, z)ï¼Œ
                    target: new THREE.Vector3(x, y, z),ç›®æ ‡ï¼šæ–°çš„THREEã€‚å‘é‡3(x, y, z)ï¼Œ
                    baseTarget: new THREE.Vector3(x, y, z),basettargetï¼šæ–°ä¸‰ã€‚å‘é‡3(x, y, z)ï¼Œ
                    velocity: new THREE.Vector3(0, 0, 0),é€Ÿåº¦ï¼šæ–°çš„ä¸‰ã€‚Vector3(0,0,0)ï¼Œ
                    type: 'bg', layer: null, targetColor: c.clone(),ç±»å‹ï¼šâ€˜bgâ€™ï¼Œå›¾å±‚ï¼šnullï¼Œ targetColor: c.clone   å…‹éš†()ï¼Œ
                    noiseOffset: Math.random() * 100,noiseOffset: Math   æ•°å­¦.random   éšæœº() * 100
                    angle: Math.random() * Math.PI * 2, angle   è§’: Math   æ•°å­¦.randomï¼ˆï¼‰   éšæœº()* 2ï¼Œ
                    radius: 20 + Math.random() * 40,Math   æ•°å­¦.random   éšæœº() * 40ï¼Œ
                    orbitSpeed: (Math.random() - 0.5) * 0.02orbitSpeed:(æ•°å­¦ã€‚éšæœºï¼ˆï¼‰- 0.5)* 0.02
                });
            }
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));å‡ ä½•å­¦ã€‚setAttribute('position'   â€œä½ç½®â€, new   æ–°    ä¸‰ã€‚BufferAttributeTHREEã€‚BufferAttribute(ä½ç½®,3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));å‡ ä½•å­¦ã€‚setAttribute('color'   â€œé¢œè‰²â€, new   æ–° THREEã€‚BufferAttribute(é¢œè‰²,3));
            geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));å‡ ä½•å­¦ã€‚setAttribute('size', new 3ã€‚BufferAttribute(å¤§å°,1));
            const material = new THREE.PointsMaterial({ size: 1.2, vertexColors: true, map: getCircleTexture(), transparent: true, opacity: 0.8, depthWrite: false, blending: THREE.AdditiveBlending });const   å¸¸é‡   ææ–™ material = new   æ–°    ä¸‰ã€‚PointsMaterialTHREEã€‚PointsMaterial({size   å¤§å°: 1.2, vertexColors: true   çœŸæ­£çš„, map   åœ°å›¾: getCircleTexture(), transparent   é€æ˜çš„: true   çœŸæ­£çš„, opacity   ä¸é€æ˜åº¦: 0.8, depthWrite: false   å‡, blending   æ··åˆ: THREEã€‚AdditiveBlending});
            particleSystem = new THREE.Points(geometry, material);particlessystem = new   æ–° THREEã€‚ç‚¹(å‡ ä½•ã€ææ–™);
            scene.add(particleSystem);
        }

        function getCircleTexture() {getCircleTexture() {
            const c = document.createElement('canvas'); c.width=64; c.height=64;const   å¸¸é‡ c = document   æ–‡æ¡£.createElement('canvas'   â€œç”»å¸ƒâ€)ï¼›c   c;.width   å®½åº¦ = 64;c.height   é«˜åº¦ = 64;
            const ctx=c.getContext('2d');const   å¸¸é‡ ctx = c.getContext (2 d);
            const g=ctx.createRadialGradient(32,32,0,32,32,32);32å²çš„å¸¸é‡g = ctx.createRadialGradient(32 0, 32å²,32å²,32);
            g.addColorStop(0,'rgba(255,255,255,1)'); g.addColorStop(1,'rgba(255,255,255,0)');
            ctx.fillStyle=g; ctx.fillRect(0,0,64,64);
            return new THREE.CanvasTexture(c);è¿”å›æ–°çš„THREE.CanvasTexture(c)ï¼›
        }

        function getShapePoints(type, text) {å‡½æ•°getShapePointsï¼ˆç±»å‹ï¼Œæ–‡æœ¬ï¼‰{
            const points = [];   Const    å¸¸é‡points   ç‚¹ = []ï¼›
            if (type === 'text') {   If (type   ç±»å‹ === 'text'   â€œæ–‡æœ¬â€) {
                const c = document.createElement('canvas'); c.width=250; c.height=250;const   å¸¸é‡ c = document   æ–‡æ¡£.createElement('canvas')ï¼›c.width = 250;c.height = 250;
                const ctx=c.getContext('2d');const ctx = c.getContext (2 d);
                ctx.font = 'bold 120px Arial';ctxã€‚font = 'bold 120px Arial'ï¼›
                ctx.fillStyle = 'white'; ctx.textAlign='center'; ctx.textBaseline='middle';ctx.fillStyle = â€˜ç™½è‰²â€™ï¼›ctx.textAlign =â€œä¸­å¿ƒâ€;ctx.textBaseline =â€œä¸­äº§â€;
                ctx.fillText(text, 125, 125);ctx.fillText(text, 125,125)ï¼›
                const data = ctx.getImageData(0,0,250,250).data;const data = ctx.getImageData(0,0,250,250).dataï¼›
                const step = 2;   Const step = 2ï¼›
                for(let y=0; y<250; y+=step) {For (let y=0; y<250; y= step) {
                    for(let x=0; x<250; x+=step) {For   ä¸º (let   è®© x=0; x<250; x= step   ä¸€æ­¥ã€‚) {
                        if(data[(y*250+x)*4+3]>128) {If (data   æ•°æ®[(y*250 x)*4 3]>128) {
                            points.push({ vec: new THREE.Vector3((x-125)/3.5, -(y-125)/3.5, 0).multiplyScalar(2), type: 'text', color: new THREE.Color(0xffffff) });ç‚¹ã€‚push({vec: new   æ–°    ä¸‰ä¸ªTHREE. vector3 ((x-125)/3.5, -(y-125)/3.5, 0). multiplyscalar (2), type   ç±»å‹: 'text'   â€œæ–‡æœ¬â€, color   é¢œè‰²: new   æ–° THREEã€‚é¢œè‰²(0 xffffff)});
                        }
                    }
                }
            } else if (type === 'cake') {
                const layers = [{y: -16, r: 18, h: 10, type: 'bottom'}, {y: -6,  r: 13, h: 8,  type: 'top'}];constå±‚= [{y: -16 r: 18 h: 10,ç±»å‹:â€œåº•éƒ¨â€},{h: y: 6 r: 13æ—¥8æ—¥ç±»å‹:â€œé¡¶çº§â€});
                layers.forEach(l => {   å±‚ã€‚forEach(1 = bb0 {
                    for(let i=0; i<(IS_MOBILE?800:1500); i++) {for   ä¸º(let   è®©   æˆ‘ i=0; i   æˆ‘<(IS_MOBILE?800:1500)ï¼›I) {
                        const theta = Math.random() * Math.PI * 2;const   å¸¸é‡   Î¸ theta = Math   æ•°å­¦.random   éšæœº() * Mathã€‚PI   Mathã€‚æ•™å®¤ä¸è§„åˆ™ * 2ï¼›
                        const r = l.r * (0.95 + Math.random()*0.05); const   å¸¸é‡ r = l.r * (0.95 Math.random   éšæœº()*0.05)ï¼›
                        const h = Math.random() * l.h;const   å¸¸é‡ h = Math   æ•°å­¦.random   éšæœº() * l.hï¼›   h;
                        points.push({ vec: new THREE.Vector3(r*Math.cos(theta), l.y+h, r*Math.sin(theta)), type: 'cake', layer: l.type });ç‚¹ã€‚pushï¼ˆ{vec: new   æ–° THREE   ä¸‰ä¸ª.Vector3ï¼‰cos   Vector3)ç§‘() l * h * r*æ•°å­¦ã€‚Sin (theta   Î¸)), type   ç±»å‹: 'cake'   â€œè›‹ç³•â€, layer   å±‚: l.type   ç±»å‹})ï¼›
                    }
                    for(let i=0; i<500; i++) {   For (let i=0; i<500; i) {
                        const theta = Math.random() * Math.PI * 2;const theta = Math.random() * Mathã€‚PI * 2ï¼›
                        const r = Math.random() * l.r;const r = Math.random() * l.rï¼›
                        points.push({ vec: new THREE.Vector3(r*Math.cos(theta), l.y+l.h, r*Math.sin(theta)), type: 'cake', layer: 'cream' });ç‚¹ã€‚pushï¼ˆ{vec: new THREE.Vector3ï¼‰cos() l y l h r*æ•°å­¦ã€‚Sin (theta)), type: 'cake', layer: 'cream'})ï¼›
                    }
                    for(let i=0; i<100; i++) {   For (let i=0; i<100; i) {
                        const theta = Math.random() * Math.PI * 2;const theta = Math.random() * Mathã€‚PI * 2ï¼›
                        const r = l.r + 0.2;   Const r = l.r 0.2ï¼›
                        const h = Math.random() * l.h;const h = Math.random() * l.hï¼›
                        const sprinkleColor = new THREE.Color().setHSL(Math.random(), 1, 0.6);const sprinkleColor = new THREE.Color(). sethsl(æ•°å­¦ã€‚Random (), 1,0.6)ï¼›
                        points.push({
                            vec: new THREE.Vector3(r*Math.cos(theta), l.y+h, r*Math.sin(theta)),vec: new   æ–°    ä¸‰ä¸ªTHREE.Vector3(r*Mathã€‚cosï¼ˆ) l y h r* math, sin   ç½ª()ï¼‰
                            type: 'cake', color: sprinkleColorç±»å‹ï¼šâ€œè›‹ç³•â€ï¼Œé¢œè‰²ï¼šâ€œäº”å½©ç¼¤çº·â€
                        });
                    }
                });
                const candleY = layers[1].y + layers[1].h;const   å¸¸é‡ candleY = layers   å±‚[1]ã€‚yå±‚[1]. h;
                for(let i=0; i<300; i++) {   For   ä¸º (let   è®©    æˆ‘i=0; i   æˆ‘<300; i   æˆ‘) {
                    const h = Math.random() * 12;   const   å¸¸é‡ h = Math   æ•°å­¦.random   éšæœº() * 12ï¼›
                    const r = Math.random() * 0.8;const   å¸¸é‡ r = Math   æ•°å­¦.random   éšæœº() * 0.8ï¼›
                    const theta = Math.random() * Math.PI * 2;const   å¸¸é‡   Î¸ theta = Math   æ•°å­¦.random   éšæœº() * Mathã€‚PI   Mathã€‚æ•™å®¤ä¸è§„åˆ™ * 2ï¼›
                    let col = (Math.sin(h*1.5 + theta)>0) ? new THREE.Color(0xFF0000) : new THREE.Color(0xFFFFFF);let   è®©   ä¸Šæ ¡ col = (mathã€‚sin(h*1.5)>0) ï¼Ÿæ–°ä¸‰äººã€‚Color(0xFF0000   0 xff0000): new   æ–° THREE   ä¸‰ä¸ª.Color   é¢œè‰²(0xFFFFFF)ï¼›
                    points.push({ vec: new THREE.Vector3(r*Math.cos(theta), candleY+h, r*Math.sin(theta)), type: 'candle', color: col });ç‚¹ã€‚pushï¼ˆ{vec: new   æ–° THREE   ä¸‰ä¸ª.Vector3ï¼‰cos   Vector3)ç§‘() candleY h r*Mathã€‚Sin (theta   Î¸))ï¼Œç±»å‹ï¼šâ€˜candleâ€™ï¼Œé¢œè‰²ï¼šcol})ï¼›
                }
                const flameY = candleY + 12;   const   å¸¸é‡ flameY = candleY 12ï¼›
                for(let i=0; i<400; i++) {   For (let i=0; i<400; i) {
                    const u = Math.random();   const u = Math.random()ï¼›
                    const h = u * 7;   Const h = u * 7ï¼›
                    const r = (1-u) * 2.0 * Math.random();const r = (1-u) * 2.0 * Math.random()ï¼›
                    const theta = Math.random() * Math.PI * 2;const theta = Math.random() * Mathã€‚PI * 2ï¼›
                    let col = new THREE.Color(0xFFA500);let col = new THREE.Color(0xFFA500)ï¼›
                    if(u<0.2) col.setHex(0x0000FF); else if(u>0.7) col.setHex(0xFF4500);å¦‚æœ(u < 0.2) col.setHex (0 x0000ff);else if(u>0.7) col.setHex(0xFF4500)ï¼›
                    points.push({ vec: new THREE.Vector3(r*Math.cos(theta), flameY+h, r*Math.sin(theta)), type: 'flame', color: col });ç‚¹ã€‚pushï¼ˆ{vec: new THREE.Vector3ï¼‰cos() h r*æ•°å­¦ã€‚Sin (theta))ï¼Œç±»å‹ï¼šâ€˜ç«ç„°â€™ï¼Œé¢œè‰²ï¼šcol})ï¼›
                }
            }
            return points;   è¿”å›ç‚¹;
                                                              }

        function preloadShapes() {   å‡½æ•°preloadShapes() {
            setTimeout(() => {   7æœˆ()=> (
                shapeCache['3'] = getShapePoints('text', '3');shapeCache['3'] = getShapePoints('text'   â€œæ–‡æœ¬â€, '3')ï¼›
                shapeCache['2'] = getShapePoints('text', '2');shapeCache['2'] = getShapePoints('text'   â€œæ–‡æœ¬â€, '2')ï¼›
                shapeCache['1'] = getShapePoints('text', '1');shapeCache['1'] = getShapePoints('text'   â€œæ–‡æœ¬â€, '1')ï¼›
                shapeCache['cake'] = getShapePoints('cake');shapeCache['cake'   â€œè›‹ç³•â€] = getShapePoints('cake'   â€œè›‹ç³•â€)ï¼›
                ui.loadingText.style.display = 'none';ui   æ´‹è‘±.loadingText.style   é£æ ¼.display   æ˜¾ç¤º = 'none'   â€œæ²¡æœ‰â€ï¼›
            }, 100);
        }

        function transitionTo(key) {å‡½æ•°transitionTo(key   å…³é”®) {
            const targets = shapeCache[key] || [];const   å¸¸é‡   ç›®æ ‡ targets = shapeCache[key   å…³é”®] || []ï¼›
            particlesData.forEach((p, i) => {particlesDataã€‚forEach((p, i   æˆ‘) = bb0 {
                if (i < targets.length) {   If (i   æˆ‘) < targetsã€‚é•¿åº¦){
                    p.baseTarget.copy(targets[i].vec);
                    p.target.copy(targets[i].vec);
                    p.type = targets[i].type;
                    p.layer = targets[i].layer;P.layer   å±‚ = targets   ç›®æ ‡[i   æˆ‘].layerï¼›
                    if(targets[i].color) {   å¦‚æœç›®æ ‡[æˆ‘]ã€‚é¢œè‰²){
                        p.targetColor = targets[i].color.clone();p.targetColor = targets   ç›®æ ‡[i   æˆ‘].color   é¢œè‰².clone()ï¼›
                    } else {
                        p.targetColor = new THREE.Color(0xffffff); 
                    }
                    const force = 3;   æ’å®šåŠ›= 3ï¼›
                    p.current.add(new THREE.Vector3((Math.random()-0.5)*force, (Math.random()-0.5)*force, (Math.random()-0.5)*force));p.currentã€‚æ·»åŠ (æ–°THREE.Vector3 ((math . random   éšæœº(-0.5)) *åŠ›é‡,(math . random   éšæœº(-0.5)) *åŠ›é‡,(math . random   éšæœº(-0.5)) *åŠ›));
                } else {
                    const angle = Math.random() * Math.PI * 2;const   å¸¸é‡   è§’ angle = Math   æ•°å­¦.random   éšæœº() * Mathã€‚PI   Mathã€‚æ•™å®¤ä¸è§„åˆ™ * 2ï¼›
                    const r = 40 + Math.random() * 40;const   å¸¸é‡ r = 40 Math   æ•°å­¦.random   éšæœº() * 40ï¼›
                    p.baseTarget.set(r*Math.cos(angle), (Math.random()-0.5)*60, r*Math.sin(angle));p.baseTarget.set   é›† (r *æ•°å­¦ã€‚å› ä¸º(è§’),(math . random   éšæœº (-0.5)) * 60, r * sin   ç½ª(è§’));
                    p.target.copy(p.baseTarget);
                    p.type = 'bg';   P.type = 'bg'ï¼›
                    p.layer = null;   P.layer = nullï¼›
                    p.targetColor = new THREE.Color(0x222222);p.targetColor = new THREE.Color(0x222222)ï¼›
                }
            });
        }

        function updateParticles() {updateParticles() {
            const positions = particleSystem.geometry.attributes.position.array;const position = particlessystem .geometry.attributes.position.arrayï¼›
            const colors = particleSystem.geometry.attributes.color.array;const colors = particlessystem .geometry.attributes.color.arrayï¼›
            const sizes = particleSystem.geometry.attributes.size.array;const size = particlessystem .geometry.attributes.size.arrayï¼›
            time += 0.02;   æ—¶é—´= 0.02ï¼›
            const blowInfluence = blowProgress / 100;const blowInfluence = blowProgress / 100ï¼›

            for (let i = 0; i < VISUAL_CONFIG.particleCount; i++) {for (let i = 0; i < VISUAL_CONFIG.particleCount; i) {
                const p = particlesData[i];   const p = particlesData[i]ï¼›
                let target = p.target.clone();è®©target = p.target.clone()ï¼›

                if (p.type === 'cake') {   If (p.type   ç±»å‹ === 'cake'   â€œè›‹ç³•â€) {
                    if (p.layer === 'bottom') p.targetColor.set(CAKE_THEME.bottom);if   å¦‚æœ (p.layer   å±‚ === 'bottom'   â€œåº•â€) p.targetColor.set   é›†(CAKE_THEME.bottom   åº•)ï¼›
                    else if (p.layer === 'top') p.targetColor.set(CAKE_THEME.top);else   å…¶ä»– if   å¦‚æœ (p.layer   å±‚ === 'top'   â€œé¡¶çº§â€) p.targetColor.set   é›†(CAKE_THEME.top   å‰)ï¼›
                    else if (p.layer === 'cream') p.targetColor.set(CAKE_THEME.cream);å¦‚æœï¼ˆp.layer   å±‚ === 'cream'   â€œéœœâ€ï¼‰ p.targetColor.set   é›†(CAKE_THEME.cream   å¥¶æ²¹)ï¼›
                }

                if (currentState === STATE.INTRO) {if   å¦‚æœ ï¼ˆcurrentState   (ç°çŠ¶å === STATE   çŠ¶æ€.ï¼‰ä»‹ç»){
                    const angle = p.angle + time * 0.05;Constè§’= pè§’æ—¶é—´* 0.05ï¼›
                    const r = p.radius + Math.sin(time * 0.5 + i * 0.01) * 10;const   å¸¸é‡ r = p.radiusæ•°å­¦ã€‚Sin (time   æ—¶é—´ * 0.5 I * 0.01) * 10ï¼›
                    target.x = Math.cos(angle) * r * 3;ç›®æ ‡ã€‚x =æ•°å­¦ã€‚Cosï¼ˆè§’åº¦ï¼‰* r * 3ï¼›
                    target.z = Math.sin(angle) * r * 3;ç›®æ ‡ã€‚z =æ•°å­¦ã€‚Sinï¼ˆè§’åº¦ï¼‰* r * 3ï¼›
                    target.y = p.baseTarget.y + Math.sin(time * 0.5 + target.x * 0.05) * 20; ç›®æ ‡ã€‚y = p. basettarget .ySinï¼ˆæ—¶é—´ï¼‰* 0.5ç›®æ ‡ã€‚X * 0.05) * 20ï¼›
                    const hue = 0.8 + (Math.sin(time * 0.1 + target.x * 0.01) * 0.1); const   å¸¸é‡   è‰²è°ƒ hue = 0.8Sinï¼ˆæ—¶é—´* 0.1ç›®æ ‡ï¼‰ã€‚X * 0.01) * 0.1)ï¼›
                    p.targetColor.setHSL(hue, 0.7, 0.6);p.targetColorã€‚setHSLï¼ˆè‰²ç›¸ï¼Œ0.7,0.6ï¼‰ï¼›
                }
                else if (currentState === STATE.CELEBRATION && p.type === 'bg') {å¦åˆ™if ï¼ˆcurrentState === STATEï¼‰ã€‚CELEBRATION && p.type === 'bg') {
                    const angle = p.angle + time * 0.1 + p.orbitSpeed;æ’å®šè§’= pè§’æ—¶é—´* 0.1 pè½¨é“é€Ÿåº¦ï¼›
                    const r = p.radius + Math.sin(time + i) * 5;const r = p.radiusæ•°å­¦ã€‚Sin (time i) * 5ï¼›
                    target.x = Math.cos(angle) * r;ç›®æ ‡ã€‚x =æ•°å­¦ã€‚Cosï¼ˆè§’åº¦ï¼‰* rï¼›
                    target.z = Math.sin(angle) * r;ç›®æ ‡ã€‚z =æ•°å­¦ã€‚Sinï¼ˆè§’åº¦ï¼‰* rï¼›
                    target.y = p.baseTarget.y + Math.sin(time + p.noiseOffset) * 2;ç›®æ ‡ã€‚y = p. basettarget .ysin(time p.noiseOffset) * 2ï¼›
                    const hue = 0.9 + (Math.sin(time + i * 0.01) * 0.05); const hue = 0.9Sinï¼ˆæ—¶é—´I * 0.01ï¼‰ * 0.05)ï¼›
                    p.targetColor.setHSL(hue, 0.8, 0.6);p.targetColorã€‚setHSLï¼ˆè‰²è°ƒï¼Œ0.8,0.6ï¼‰ï¼›
                } 
                else if (currentState === STATE.IDLE) {å¦åˆ™if ï¼ˆcurrentState   (ç°çŠ¶å === STATEï¼‰ã€‚é—²ç½®){
                    const angle = p.angle + time * 0.1;Constè§’= pè§’æ—¶é—´* 0.1ï¼›
                    const r = p.radius + Math.sin(time + i * 0.01)*2;const r = p.radiusæ•°å­¦ã€‚Sinï¼ˆæ—¶é—´I * 0.01ï¼‰*2ï¼›
                    target.x = Math.cos(angle) * r;ç›®æ ‡ã€‚x =æ•°å­¦ã€‚Cosï¼ˆè§’åº¦ï¼‰* rï¼›
                    target.z = Math.sin(angle) * r;ç›®æ ‡ã€‚z =æ•°å­¦ã€‚Sinï¼ˆè§’åº¦ï¼‰* rï¼›
                    target.y = p.baseTarget.y + Math.sin(time + target.x * 0.05) * 5; ç›®æ ‡ã€‚y = p. basettarget .yç½ª(æ—¶é—´ç›®æ ‡ã€‚X * 0.05) * 5ï¼›
                    p.targetColor.set(0x333333); 
                }

                if   å¦‚æœ (p.type   ç±»å‹ === 'flame'   â€œç«ç„°â€) {
                    const   å¸¸é‡ noise = Math   æ•°å­¦.sin   ç½ª(time   æ—¶é—´ * 6 + p.noiseOffset) * 0.6;const noise = Mathã€‚sin(time * 6p . noiseoffset) * 0.6ï¼›
                    target   ç›®æ ‡.x += noise;   ç›®æ ‡ã€‚X =å™ªå£°ï¼›
                    if   å¦‚æœ (blowInfluence > 0.1 || currentState   ç°çŠ¶å === STATE   çŠ¶æ€.CELEBRATION   åº†ç¥æ´»åŠ¨) {
                        let   è®©   ç”µæ¢¯ lift = blowInfluence * 25;let lift = blowInfluence * 25ï¼›
                        if   å¦‚æœ(currentState   ç°çŠ¶å === STATE   çŠ¶æ€.CELEBRATION   åº†ç¥æ´»åŠ¨) lift   ç”µæ¢¯ = 60;ifï¼ˆcurrentState === STATE.ï¼‰CELEBRATION)å‡åŠ›= 60ï¼›
                        target   ç›®æ ‡.y += lift   ç”µæ¢¯;   ç›®æ ‡ã€‚Y =å‡åŠ›ï¼›
                        target   ç›®æ ‡.x += (Math   æ•°å­¦.random   éšæœº()-0.5) * lift   ç”µæ¢¯ * 0.8;ç›®æ ‡ã€‚x = (Math.random()-0.5) * lift * 0.8ï¼›
                        p.targetColor.lerp(new   æ–°    ä¸‰ä¸ªTHREE.Color   é¢œè‰²(0xdddddd), 0.1); 
                    }
                }

                p.current   å½“å‰çš„.lerp(target   ç›®æ ‡, 0.08);p.currentã€‚æ˜†è™«èœœ(ç›®æ ‡,0.08);

                positions   èŒä½[i   æˆ‘*3] = p.current   å½“å‰çš„.x;ä½ç½®[i*3] = p.current.xï¼›
                positions   èŒä½[i   æˆ‘*3+1] = p.current   å½“å‰çš„.y;position [i*3 1] = p.current.yï¼›
                positions   èŒä½[i   æˆ‘*3+2] = p.current   å½“å‰çš„.z;position [i*3 2] = p.current.zï¼›
                
                colors   é¢œè‰²[i   æˆ‘*3] += (p.targetColor.r - colors   é¢œè‰²[i   æˆ‘*3]) * 0.1;é¢œè‰²[i*3] = (p.ç›®æ ‡é¢œè‰²)ã€‚r -é¢œè‰²[i*3]] * 0.1;
                colors   é¢œè‰²[i   æˆ‘*3+1] += (p.targetColor.g - colors   é¢œè‰²[i   æˆ‘*3+1]) * 0.1;é¢œè‰²[i*3 1] = (p.targetColorã€‚g -é¢œè‰²[i*3 1]) * 0.1ï¼›
                colors   é¢œè‰²[i   æˆ‘*3+2] += (p.targetColor.b - colors   é¢œè‰²[i   æˆ‘*3+2]) * 0.1;é¢œè‰²[i*3 2] = (p.targetColorã€‚b -é¢œè‰²[i*3 2]) * 0.1ï¼›

                if   å¦‚æœ (p.type   ç±»å‹ === 'flame'   â€œç«ç„°â€ && (blowInfluence > 0.1 || currentState   ç°çŠ¶å === STATE   çŠ¶æ€.CELEBRATION   åº†ç¥æ´»åŠ¨)) {
                    sizes   å¤§å°[i   æˆ‘] = Math   æ•°å­¦.max   é©¬å…‹æ–¯(0, 1.5 * (1 - blowInfluence)); å¤§å°[i] =æ•°å­¦ã€‚æœ€å¤§ï¼ˆ0,1.5 * (1 - blowInfluence)ï¼‰ï¼›
                    if   å¦‚æœ(currentState   ç°çŠ¶å === STATE   çŠ¶æ€.CELEBRATION   åº†ç¥æ´»åŠ¨) sizes   å¤§å°[i   æˆ‘] *= 0.9;ifï¼ˆcurrentState === STATE.ï¼‰CELEBRATION) size [i] *= 0.9ï¼›
                } else   å…¶ä»– {
                    sizes   å¤§å°[i   æˆ‘] = 1.2 + Math   æ•°å­¦.sin   ç½ª(time   æ—¶é—´ + i   æˆ‘) * 0.3;size [i] = 1.2Sin (time i) * 0.3ï¼›
                }
                                                      }

            particleSystem.geometry   å‡ ä½•.attributes   å±æ€§.position   ä½ç½®.needsUpdate = true   çœŸæ­£çš„;particlessystem .geometry. properties .position. needsupdate = trueï¼›
            particlessystem .geometry.attributes.color. needsupdate = trueï¼›particleSystem.geometry   å‡ ä½•.attributes   å±æ€§.color   é¢œè‰².needsUpdate = true   çœŸæ­£çš„;
            particlessystem .geometry.attributes.size. needsupdate = trueï¼›particleSystem.geometry   å‡ ä½•.attributes   å±æ€§.size   å¤§å°.needsUpdate = true   çœŸæ­£çš„;
            
            if   å¦‚æœ (interactionMode === 1) {
                   å¦‚æœ(!isDragging) {if   å¦‚æœ (!isDragging) {
                    rotationVelocity *= 0.96ï¼›rotationVelocity *= 0.96; 
                    particlessystem . rotate .y = rotationVelocityï¼›particleSystem.rotation   æ—‹è½¬.y += rotationVelocity + autoRotateSpeed;
                }
            } else if (currentState ï¼= =çŠ¶æ€ã€‚ç©ºé—²&&å½“å‰çŠ¶æ€ï¼= =çŠ¶æ€ã€‚ä»‹ç»){} else   å…¶ä»– if   å¦‚æœ (currentState   ç°çŠ¶å !== STATE   çŠ¶æ€.IDLE   é—²ç½® && currentState   ç°çŠ¶å !== STATE   çŠ¶æ€.INTRO) {
                particlessystem .rotation.y =æ•°å­¦ã€‚Sinï¼ˆæ—¶é—´* 0.15ï¼‰* 0.15ï¼›particleSystem.rotation.y = Math.sin(time * 0.15) * 0.15;
            } else   å…¶ä»– {
                particlessystem . rotate .y = 0ï¼›particleSystem.rotation   æ—‹è½¬.y = 0;
            }
                                       }

        /* --- ä¸šåŠ¡é€»è¾‘ --- */
        let   è®© transitionLock = falseï¼›let transitionLock = false   å‡;

        å‡½æ•°startSequence() {function   å‡½æ•° startSequence() {
            if   å¦‚æœ ï¼ˆcurrentState !ï¼‰= =çŠ¶æ€ã€‚|| transitionLock)è¿”å›ï¼›if (currentState   ç°çŠ¶å !== STATE   çŠ¶æ€.IDLE   é—²ç½® || transitionLock) return   è¿”å›;
                        
            // æ¸…é™¤è‡ªåŠ¨å€’æ•°è®¡æ—¶å™¨
            if   å¦‚æœ (autoEntryTimer) {
                clearInterval(autoEntryTimer);
                   autoEntryTimer = nullï¼›autoEntryTimer = null   é›¶;
            }
            ui   æ´‹è‘±.autoCountdownText.classList.add(éšå«);ui.autoCountdownText.classList   ç­çº§åå†Œ.add   æ·»åŠ ('hidden'   â€œéšè—â€);

            log   æ—¥å¿—('æ£€æµ‹åˆ°æ‰‹åŠ¿ï¼Œå¼€å§‹å€’è®¡æ—¶åºåˆ—');
               transitionLock = trueï¼›transitionLock = true   çœŸæ­£çš„;
            currentState   ç°çŠ¶å = STATE.COUNTDOWNï¼›currentState = STATE   çŠ¶æ€.COUNTDOWN   å€’è®¡æ—¶;
            ui   æ´‹è‘±.statusText.innerText = â€œæ£€æµ‹åˆ°æ‰‹åŠ¿â€ï¼›ui.statusText.innerText = "GESTURE DETECTED"   â€œæ‰‹åŠ¿æ£€æµ‹â€;
            ui   æ´‹è‘±.statusText.className = "text-xs md:text-sm - text-green-400 font-bold track - width "ï¼›ui.statusText.className   ç±»åç§° = "text-xs md:text-sm text-green-400 font-bold tracking-wider"â€œ font- familyï¼šå®‹ä½“ï¼Œfont- familyï¼šå®‹ä½“â€;
            ui   æ´‹è‘±.statusDot.className = "inline-block w- 2h - 2full - bg-green- 500mr - 2shadow -[0_0_8px_#0f0]"ï¼›ui.statusDot.className   ç±»åç§° = "inline-block w-2 h-2 rounded-full bg-green-500 mr-2 shadow-[0_0_8px_#0f0]"â€œinline-block w-2 h-2åœ†-full - bg-green-500 mr-2 shadow-[0_0_8px_#0f0]â€;
            ui   æ´‹è‘±.handIcon.style.display = 'none'ï¼›ui.handIcon.style   é£æ ¼.display   æ˜¾ç¤º = 'none'   â€œæ²¡æœ‰â€;
               è®¾count = 3ï¼›let count = 3;
            ui   æ´‹è‘±.mainText.innerText = "";
            ui   æ´‹è‘±.subText   æ½œå°è¯.innerText = "";
            transitionTo('3');
            const   å¸¸é‡   è®¡æ—¶å™¨ timer = setInterval(() => {
                   æ•°,count   æ•°--;
                å¦‚æœï¼ˆcount > 0ï¼‰ {if   å¦‚æœ (count   æ•° > 0) {
                    transitionTo(count   æ•°.toString());
                } else   å…¶ä»– {
                       clearInterval(è®¡æ—¶å™¨);clearInterval(timer   è®¡æ—¶å™¨);
                    showCake();
                }
            }, 1200);
        }

           å‡½æ•°showCake() {function   å‡½æ•° showCake() {
            log   æ—¥å¿—('å±•ç¤ºè›‹ç³•ï¼Œå¼€å¯å¹æ°”æ£€æµ‹');
            currentState   ç°çŠ¶å = STATE   çŠ¶æ€.BLOWING   å¹;
               transitionTo(â€œè›‹ç³•â€);transitionTo('cake'   â€œè›‹ç³•â€);
            ui   æ´‹è‘±. settingspan .style.display = 'flex'ï¼›ui.settingsPanel.style   é£æ ¼.display   æ˜¾ç¤º = 'flex'   â€œå¼¯æ›²â€;
            ui   æ´‹è‘±.mainText.innerText = "";
            ui   æ´‹è‘±.subText   æ½œå°è¯.innerText = "";
            ui   æ´‹è‘±.topBanner.classList.remove(éšå«);ui.topBanner.classList   ç­çº§åå†Œ.remove   åˆ é™¤('hidden'   â€œéšè—â€); 
            ui. statusttext . innertext = â€œMIC LISTENINGâ€¦â€ï¼›ui.statusText.innerText = "MIC LISTENING...";
            ui.blowMeter.style.opacity = '1';
            ui   æ´‹è‘±.blowHint.style   é£æ ¼.opacity   ä¸é€æ˜åº¦ = '1';
        }

        å‡½æ•°successCelebration() {function   å‡½æ•° successCelebration() {
            log   æ—¥å¿—('è®¸æ„¿æˆåŠŸï¼æ’­æ”¾åº†ç¥åŠ¨ç”»');
            currentState   ç°çŠ¶å = STATE   çŠ¶æ€.CELEBRATIONï¼›currentState = STATE   çŠ¶æ€.CELEBRATION   åº†ç¥æ´»åŠ¨;
            ui   æ´‹è‘±.statusText.innerText = â€œè®¸æ„¿â€ï¼›ui.statusText.innerText = "WISH GRANTED"   â€œå¸Œæœ›æˆäºˆâ€;
            ui   æ´‹è‘±.blowMeter.style   é£æ ¼.opacity   ä¸é€æ˜åº¦ = '0';
            ui   æ´‹è‘±.blowHint.style   é£æ ¼.opacity   ä¸é€æ˜åº¦ = '0';
            ui   æ´‹è‘±. settingspan .style   é£æ ¼.display   æ˜¾ç¤º = 'none'   â€œæ²¡æœ‰â€ï¼›ui   iu;.settingsPanel.style   é£æ ¼.display   æ˜¾ç¤º = 'none'   â€œæ²¡æœ‰â€;
            
            document   æ–‡æ¡£.body   èº«ä½“.classList   ç­çº§åå†Œ.add   æ·»åŠ (â€œshake   â€œæ‘‡-screenâ€   å±å¹•â€);document   æ–‡æ¡£.body   èº«ä½“.classList   ç­çº§åå†Œ.add   æ·»åŠ ('shake-screen'   â€œshake-screenâ€   å±å¹•â€);
            setTimeout(()) => document   æ–‡æ¡£.body   èº«ä½“.classListã€‚åˆ é™¤(â€œshake   â€œæ‘‡-screenâ€   å±å¹•â€),500);setTimeout(() => document   æ–‡æ¡£.body   èº«ä½“.classList   ç­çº§åå†Œ.remove   åˆ é™¤('shake-screen'   â€œshake-screenâ€   å±å¹•â€), 500);

            particlesDataã€‚forEach(p => {particlesData.forEach(p => {
                if   å¦‚æœ (p.type   ç±»å‹ === 'cake'   â€œè›‹ç³•â€ || p.type   ç±»å‹ === 'candle'   â€œèœ¡çƒ›â€ || p.type   ç±»å‹ === 'ring'   â€œç¯â€) {å¦‚æœ(p.type   ç±»å‹ = = = 'è›‹ç³•' | | p.type   ç±»å‹ = = =â€œèœ¡çƒ›â€| | p.type   ç±»å‹ = = = 'ç¯'){
                    p.target   ç›®æ ‡.y = Math   æ•°å­¦.sinï¼ˆp   ç½ª(p.current   å½“å‰çš„.ï¼‰X   ) X * 0.5) * 0.5ï¼›p.target   ç›®æ ‡.y += Math   æ•°å­¦.sin   ç½ª(p.current   å½“å‰çš„.x * 0.5) * 0.5; 
                } else   å…¶ä»– if   å¦‚æœ ï¼ˆp   (p.type   ç±»å‹ !ï¼‰== â€˜ç«ç„°â€™){} else   å…¶ä»– if   å¦‚æœ (p.type   ç±»å‹ !== 'flame'   â€œç«ç„°â€) {
                       P.type   ç±»å‹ = 'bg'   â€œbgâ€ï¼›p.type   ç±»å‹ = 'bg'   â€œbgâ€; 
                }
            });

               7æœˆ()=> (setTimeout(() => {
                ui   æ´‹è‘±.surpriseLayer.classList   ç­çº§åå†Œ.remove   åˆ é™¤(éšå«);ui   æ´‹è‘±.surpriseLayer.classList   ç­çº§åå†Œ.remove   åˆ é™¤('hidden'   â€œéšè—â€);
                ui   æ´‹è‘±.surpriseLayer.classList   ç­çº§åå†Œ.add   æ·»åŠ (â€œæ´»è·ƒçš„â€);ui   æ´‹è‘±.surpriseLayer.classList   ç­çº§åå†Œ.add   æ·»åŠ ('active'   â€œæ´»è·ƒâ€);
                ui   æ´‹è‘±.revealBtn.classList   ç­çº§åå†Œ.remove   åˆ é™¤(éšå«);ui   æ´‹è‘±.revealBtn.classList   ç­çº§åå†Œ.remove   åˆ é™¤('hidden'   â€œéšè—â€);
            }, 1500);
        }

        . getelementbyid(â€œpicker   â€œé€‰æ‹©å™¨-bottomâ€   åº•â€)ã€‚addEventListener('input'   â€œè¾“å…¥â€, (e) => CAKE_THEMEã€‚Bottom   CAKE_THEMEã€‚åº• = e.p agtarget .value   ä»·å€¼)ï¼›document   æ–‡æ¡£.getElementById('picker-bottom'   â€œpicker-bottomâ€   åº•â€).addEventListener('input'   â€œè¾“å…¥â€, (e) => CAKE_THEME.bottom   åº• = e.target   ç›®æ ‡.value   ä»·å€¼);
        . getelementbyid(â€œpicker   â€œé€‰æ‹©å™¨-topâ€   â€)ã€‚addEventListener('input'   â€œè¾“å…¥â€, (e) => CAKE_THEMEã€‚Top   CAKE_THEMEã€‚å‰ = e.p agtarget .value   ä»·å€¼)ï¼›document   æ–‡æ¡£.getElementById('picker-top'   â€œpicker-topâ€   â€).addEventListener('input'   â€œè¾“å…¥â€, (e) => CAKE_THEME.top   å‰ = e.target   ç›®æ ‡.value   ä»·å€¼);
        . getelementbyid(â€œpicker   â€œé€‰æ‹©å™¨-creamâ€   éœœâ€)ã€‚addEventListener('input'   â€œè¾“å…¥â€, (e) => CAKE_THEMEã€‚å¥¶æ²¹= e.p agtarget .value   ä»·å€¼)ï¼›document   æ–‡æ¡£.getElementById('picker-cream'   â€œpicker-creamâ€   éœœâ€).addEventListener('input'   â€œè¾“å…¥â€, (e) => CAKE_THEME.cream   å¥¶æ²¹ = e.target   ç›®æ ‡.value   ä»·å€¼);
        
        ui   æ´‹è‘±.settingsToggleã€‚addEventListener('click'   â€œç‚¹å‡»â€, (e) => {ui   æ´‹è‘±.settingsToggle.addEventListener('click'   â€œç‚¹å‡»â€, (e) => {
            e.stopPropagation();
            const   å¸¸é‡   æ˜¾ç¤º display   æ˜¾ç¤º = ui   æ´‹è‘±. settingspan .style   é£æ ¼.displayï¼›const display   æ˜¾ç¤º = ui   æ´‹è‘±.settingsPanel.style   é£æ ¼.display   æ˜¾ç¤º;
            ui   æ´‹è‘±.settingsPanel.style   é£æ ¼.display   æ˜¾ç¤º = (display   æ˜¾ç¤º === 'none'   â€œæ²¡æœ‰â€ || display   æ˜¾ç¤º === ") ï¼Ÿâ€˜flexâ€™ï¼š â€˜noneâ€™ï¼›ui.settingsPanel.style.display = (display === 'none' || display === '') ? 'flex' : 'none';   â€œæ²¡æœ‰â€
        });

        // ç¬¬ä¸€é¡µç¥ç¦è¯­
        const   å¸¸é‡ wishes_part1 = [
            "è€å©†ç”Ÿæ—¥å¿«ä¹ï¼",
            "å—¯â€¦",
            "è¿™æ˜¯ç‹—ç‹—è®¤è¯†è€å©†ä»¥æ¥ï¼Œ",
            "ç‹—ç‹—é™ªè€å©†åº¦è¿‡çš„ç¬¬ä¸€ä¸ªç”Ÿæ—¥ï¼Œ",
            "ç‹—ç‹—æ²¡æƒ³åˆ°ä¼šè¿™ä¹ˆå¹¸è¿ã€‚",
            "å¯ä»¥æœ‰æœºä¼šå’Œè€å©†ä¸€èµ·åº¦è¿‡è¿™ä¹ˆé‡è¦çš„æ—¶åˆ»ï¼Œ",
            "ç‹—ç‹—å¸Œæœ›è€å©†å¼€å¼€å¿ƒå¿ƒï¼Œå¥å¥åº·åº·ã€‚",
            "ä»¥åä¹Ÿè¦ä¸€èµ·è¿‡æ¯ä¸€ä¸ªç”Ÿæ—¥ã€‚",
            "æˆ‘çˆ±ä½ è€å©†ï¼"ã€‚
            "           â€”â€” é€ç»™è€å©†"
        ];

        // ç¬¬äºŒé¡µæ­‰æ„ä¸å¿«é€’
        const   å¸¸é‡ wishes_part2 = [
            "è€å©†",
            "ç‹—ç‹—çŸ¥é“è‡ªå·±æœ‰äº›æ–¹é¢åšçš„ä¸å¤Ÿå¥½ã€‚ğŸ˜­",
            "è€å©†çœŸçš„ç‰¹åˆ«åŒ…å®¹ç‹—ç‹—",
            "ç‹—ç‹—æ„¿æ„ä¸ºè€å©†çŒ®å‡ºä¸€åˆ‡",
            "ç‹—ç‹—åœ¨æ¥ä¸‹å»çš„æ—¥å­é‡Œä¼šæ›´åŠ æ›´åŠ ä¹–",
            "ç‹—ç‹—æƒ³åšè€å©†æœ€ä¹–æœ€ä¹–çš„ç‹—ç‹—",
            "ä¹Ÿæƒ³æ˜¯å”¯ä¸€çš„é‚£ä¸ªã€‚",
            "ç‹—ç‹—ä¸èƒ½å’Œè€å©†è§é¢ï¼Œæ‰€ä»¥",
            "æ‰€ä»¥åªèƒ½ç”¨è¿™ç§æ–¹å¼ğŸ“¸ğŸ˜Š",
            "ç‹—ç‹—çœŸå¿ƒçš„ç¥è€å©†ç”Ÿæ—¥å¿«ä¹ï¼ğŸ˜†"
        ];

        function   å‡½æ•°   æ‰“å­—æœº typeWriter   æ‰“å­—æœº(textArray, containerId, speed   é€Ÿåº¦ = 50) {
            const   å¸¸é‡   å®¹å™¨ container   å®¹å™¨ = document   æ–‡æ¡£.getElementById(containerId)ï¼›const container   å®¹å™¨ = document   æ–‡æ¡£.getElementById(containerId);
            container   å®¹å™¨.innerHTML = "";
               let   è®© lineIndex = 0ï¼›let    ,è®©lineIndex = 0;
               let   è®© charIndex = 0ï¼›let    ,è®©charIndex = 0;

               å‡½æ•°ç±»å‹ï¼ˆï¼‰{function   å‡½æ•°   ç±»å‹ type   ç±»å‹() {
                å¦‚æœ(lineIndex < textArrayã€‚length)â€”â€”if (lineIndex < textArray.length   é•¿åº¦) {
                    const   å¸¸é‡ currentLine = textArray[lineIndex]ï¼›const currentLine = textArray[lineIndex];
                    if   å¦‚æœ ï¼ˆcharIndex < currentLine. ifï¼‰é•¿åº¦){if   å¦‚æœ (charIndex < currentLine.length   é•¿åº¦) {
                        å®¹å™¨ã€‚innerHTML = currentLine.charAt(charIndex)container   å®¹å™¨.innerHTML += currentLine.charAt(charIndex);
                           charIndex;charIndex++;
                           setTimeout(ç±»å‹ã€é€Ÿåº¦);setTimeout(type   ç±»å‹, speed   é€Ÿåº¦);
                    } else   å…¶ä»– {
                        å®¹å™¨ã€‚innerHTML = "
"ï¼›container.innerHTML += "<br>";
                           lineIndex;lineIndex++;
                        charIndex = 0;
                           setTimeout(ç±»å‹,300);setTimeout(type   ç±»å‹, 300);
                    }
                    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                    container   å®¹å™¨.scrollTop = container   å®¹å™¨.scrollHeight;
                }
            }
               ç±»å‹();type   ç±»å‹();
        }

        ui.revealBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            ui.revealBtn.classList.add('hidden');
            ui.cardContainer.classList.remove('hidden');
        });

        // "What's the surprise" æŒ‰é’® -> ç¿»è½¬åˆ°èƒŒé¢ (ç¬¬ä¸€é¡µ)
        ui.nextBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            ui.cardContainer.classList.add('flipped');
            // æ˜¾ç¤ºç¬¬ä¸€é¡µï¼Œéšè—ç¬¬äºŒé¡µ
            ui.page1.classList.remove('hidden');
            ui.page2.classList.add('hidden');
            setTimeout(() => typeWriter(wishes_part1, 'typewriter-text-1'), 400);
        });

        // "è¿˜æœ‰è¯å¯¹ä½ è¯´" æŒ‰é’® -> åˆ‡æ¢åˆ°ç¬¬äºŒé¡µ
        ui.toPage2Btn.addEventListener('click', (e) => {
            e.stopPropagation();
            ui.page1.classList.add('hidden');
            ui.page2.classList.remove('hidden');
            // é‡æ–°è§¦å‘ç¬¬äºŒé¡µçš„æ‰“å­—æœº
            setTimeout(() => typeWriter(wishes_part2, 'typewriter-text-2', 30), 100);
        });

        ui.floatingGiftBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            ui.floatingGiftBtn.classList.add('hidden'); 
            ui.surpriseLayer.classList.remove('hidden'); 
            ui.surpriseLayer.classList.add('active');
            interactionMode = 0;
            ui.cardContainer.classList.remove('hidden');
            ui.cardContainer.classList.remove('flipped');
            // é‡ç½®ä¸ºç¬¬ä¸€é¡µçŠ¶æ€
            ui.page1.classList.remove('hidden');
            ui.page2.classList.add('hidden');
        });

        // "æ”¶èµ·å¡ç‰‡" æŒ‰é’®
        ui.closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            ui.mainText.innerText = ""; 
            ui.surpriseLayer.classList.remove('active');
            ui.surpriseLayer.classList.add('hidden');    
            ui.floatingGiftBtn.classList.remove('hidden');
            
            interactionMode = 1; 
            transitionTo('cake'); 
            ui.statusText.innerText = "INTERACTIVE MODE: DRAG TO ROTATE";
            ui.typewriter.innerHTML = ""; 
            ui.topBanner.classList.remove('hidden');
        });

        
        // --- è‡ªåŠ¨å€’æ•°åŠŸèƒ½ ---
        function startAutoEntryCountdown() {
            autoEntrySeconds = 15;
            ui.autoCountdownText.classList.remove('hidden');
            ui.autoCountdownText.innerText = `è‹¥æœªæ£€æµ‹åˆ°æ‰‹åŠ¿ï¼Œ${autoEntrySeconds}ç§’åè‡ªåŠ¨å¼€å§‹...`;
            
            // æ¸…é™¤æ—§çš„è®¡æ—¶å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (autoEntryTimer) clearInterval(autoEntryTimer);

            autoEntryTimer = setInterval(() => {
                autoEntrySeconds--;
                if (autoEntrySeconds > 0) {
                    ui.autoCountdownText.innerText = `è‹¥æœªæ£€æµ‹åˆ°æ‰‹åŠ¿ï¼Œ${autoEntrySeconds}ç§’åè‡ªåŠ¨å¼€å§‹...`;
                } else {
                    clearInterval(autoEntryTimer);
                    autoEntryTimer = null;
                    ui.autoCountdownText.classList.add('hidden');
                    // åªæœ‰åœ¨è¿˜æ˜¯ IDLE çŠ¶æ€æ—¶æ‰è‡ªåŠ¨å¼€å§‹ï¼Œé˜²æ­¢ç”¨æˆ·åˆšå¥½åœ¨æ­¤æ—¶è§¦å‘äº†æ‰‹åŠ¿
                    if (currentState === STATE.IDLE) {
                        log('è‡ªåŠ¨å€’æ•°ç»“æŸï¼Œè§¦å‘å¼€å§‹åºåˆ—');
                        startSequence();
                    }
                }
            }, 1000);
        }

        // æŒ‰é’®ç‚¹å‡»äº‹ä»¶å¤„ç†
        ui.startBtn.addEventListener('click', async function() {
            log('ç‚¹å‡»äº†è¿›å…¥æŒ‰é’®...');
            const btn = this;
            
            if (typeof Hands === 'undefined') {
                log('è­¦å‘Š: MediaPipe åº“åŠ è½½å»¶è¿Ÿã€‚');
            }

            btn.innerHTML = '<span class="animate-pulse">Loading...</span>';
            btn.disabled = true;
            ui.loadingText.style.display = 'block';
            
            try {
                fadeAudioIn();
                await initAudio();
                log('éŸ³é¢‘åˆå§‹åŒ–æˆåŠŸ');
            } catch(e) {
                log('éŸ³é¢‘åˆå§‹åŒ–è­¦å‘Š: ' + e);
                ui.statusText.innerText = "AUDIO/MIC LIMITED";
            }

            try {
                log('å°è¯•å¯åŠ¨æ‘„åƒå¤´...');
                await initCamera();
                log('æ‘„åƒå¤´å¯åŠ¨æˆåŠŸ');
            } catch (e) {
                log('æ‘„åƒå¤´/MediaPipe å¤±è´¥: ' + e);
                ui.statusText.innerText = "CAMERA FAILED - USE SPACEBAR";
            }
            
            log('è¿›å…¥ä¸»ç•Œé¢...');
            currentState = STATE.IDLE;
            ui.startOverlay.classList.add('hidden');
            ui.uiLayer.style.display = 'flex';

            // å¯åŠ¨è‡ªåŠ¨å€’æ•°
            startAutoEntryCountdown();
        });

        async function initAudio() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioContext.createMediaStreamSource(stream);
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                source.connect(analyser);
                checkAudio();
            } catch (e) {
                log('éº¦å…‹é£æƒé™è¢«æ‹’ç»');
                ui.statusText.innerText = "MIC DENIED - USE TOUCH/SPACE";
                throw e;
            }
        }

        document.addEventListener('touchstart', (e) => {
            if(currentState === STATE.BLOWING && !e.target.closest('button') && !e.target.closest('input')) {
                isTouching = true;
            }
        }, {passive: false});

        document.addEventListener('touchend', () => isTouching = false);
        document.addEventListener('touchcancel', () => isTouching = false);
        document.addEventListener('keydown', (e) => { if(e.code === 'Space') isSpacePressed = true; });
        document.addEventListener('keyup', (e) => { if(e.code === 'Space') isSpacePressed = false; });

        function checkAudio() {
            requestAnimationFrame(checkAudio);
            if (currentState !== STATE.BLOWING) return;
            let volume = 0;
            if (analyser) {
                const data = new Uint8Array(analyser.frequencyBinCount);
                analyser.getByteFrequencyData(data);
                let sum = 0; for(let i=0; i<data.length; i++) sum += data[i];
                volume = sum / data.length;
            }
            if (volume > VISUAL_CONFIG.blowThreshold || isSpacePressed || isTouching) {
                isBlowing = true;
                blowProgress += 0.8; 
            } else {
                isBlowing = false;
                blowProgress -= 0.3; 
            }
            blowProgress = Math.max(0, Math.min(100, blowProgress));
            ui.blowBar.style.width = blowProgress + '%';
            if (blowProgress >= 100) successCelebration();
        }

        function fadeAudioIn() {
            const playPromise = bgm.play();
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    log('èƒŒæ™¯éŸ³ä¹å¼€å§‹æ’­æ”¾');
                }).catch(error => {
                    log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’');
                });
            }
            
            bgm.volume = 0;
            let vol = 0;
            const fade = setInterval(() => {
                vol += 0.05;
                if(vol >= 0.5) { vol = 0.5; clearInterval(fade); }
                bgm.volume = vol;
            }, 200);
        }
        
        document.getElementById('music-btn').addEventListener('click', () => {
            if (bgm.paused) bgm.play(); else bgm.pause();
        });

        async function initCamera() {
            const video = document.getElementsByClassName('input_video')[0];
            
            if (typeof Hands === 'undefined' || typeof Camera === 'undefined') {
                throw new Error("MediaPipe åº“æœªåŠ è½½");
            }

            const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${file}`});
            
            hands.setOptions({ 
                maxNumHands: 1, 
                modelComplexity: 0, 
                minDetectionConfidence: 0.5, 
                minTrackingConfidence: 0.5 
            });
            
            hands.onResults((results) => {
                if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                    ui.camStatusDot.className = "w-1.5 h-1.5 rounded-full bg-green-400 shadow-[0_0_8px_#4ade80]";
                    ui.camStatusText.innerText = "DETECTED";
                    ui.camStatusText.className = "text-[8px] text-green-400 font-mono font-bold";
                    
                    if (currentState === STATE.IDLE) {
                        startSequence();
                    }
                    if (interactionMode === 1) {
                        const currentHandX = results.multiHandLandmarks[0][9].x; 
                        const delta = currentHandX - lastHandX;
                        if (Math.abs(delta) > 0.002) {
                            // å¤§å¹…æé«˜æ‰‹åŠ¿æ§åˆ¶çµæ•åº¦
                            rotationVelocity += delta * -0.4; 
                        }
                        lastHandX = currentHandX;
                    }
                } else {
                    ui.camStatusDot.className = "w-1.5 h-1.5 rounded-full bg-red-500";
                    ui.camStatusText.innerText = "NO HAND";
                    ui.camStatusText.className = "text-[8px] text-red-400 font-mono";
                }

                const ctx = document.getElementById('output_canvas').getContext('2d');
                ctx.clearRect(0, 0, 160, 120);
                if(results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                     for (const l of results.multiHandLandmarks) {
                         drawConnectors(ctx, l, HAND_CONNECTIONS, {color: '#ff69b4', lineWidth: 2});
                     }
                }
            });

            const camera = new Camera(video, { 
                onFrame: async () => { await hands.send({image: video}); }, 
                width: 320, 
                height: 240 
            });
            
            return camera.start();
        }

        function render() {
            requestAnimationFrame(render);
            updateParticles();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
